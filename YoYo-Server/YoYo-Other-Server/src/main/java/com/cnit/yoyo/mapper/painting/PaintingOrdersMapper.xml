<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cnit.yoyo.dao.painting.PaintingOrdersMapper" >
  <resultMap id="BaseResultMap" type="com.cnit.yoyo.model.painting.PaintingOrders" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jun 04 10:40:13 CST 2015.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="createtime" property="createtime" jdbcType="TIMESTAMP" />
    <result column="car_damage_id" property="carDamageId" jdbcType="INTEGER" />
    <result column="car_damage_offer_id" property="carDamageOfferId" jdbcType="INTEGER" />
    <result column="store_id" property="storeId" jdbcType="INTEGER" />
    <result column="store_name" property="storeName" jdbcType="VARCHAR" />
    <result column="last_modified" property="lastModified" jdbcType="TIMESTAMP" />
    <result column="payment" property="payment" jdbcType="VARCHAR" />
    <result column="payment_id" property="paymentId" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="pay_status" property="payStatus" jdbcType="VARCHAR" />
    <result column="confirm" property="confirm" jdbcType="VARCHAR" />
    <result column="tostr" property="tostr" jdbcType="VARCHAR" />
    <result column="score_u" property="scoreU" jdbcType="VARCHAR" />
    <result column="score_g" property="scoreG" jdbcType="VARCHAR" />
    <result column="payed" property="payed" jdbcType="DECIMAL" />
    <result column="memo" property="memo" jdbcType="VARCHAR" />
    <result column="disabled" property="disabled" jdbcType="VARCHAR" />
    <result column="mark_type" property="markType" jdbcType="VARCHAR" />
    <result column="mark_text" property="markText" jdbcType="VARCHAR" />
    <result column="confirm_time" property="confirmTime" jdbcType="TIMESTAMP" />
    <result column="consumption_time" property="consumptionTime" jdbcType="TIMESTAMP" />
    <result column="comments_count" property="commentsCount" jdbcType="INTEGER" />
    <result column="refund_status" property="refundStatus" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="member_id" property="memberId" jdbcType="INTEGER" />
    <result column="account_id" property="accountId" jdbcType="INTEGER" />
    <result column="source" property="source" jdbcType="VARCHAR" />
    <result column="company_id" property="companyId" jdbcType="BIGINT" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jun 04 10:40:13 CST 2015.
    -->
    id, createtime, car_damage_id, car_damage_offer_id, store_id, store_name, last_modified, 
    payment, payment_id, status, pay_status, confirm, tostr, score_u, score_g, payed, memo, disabled, 
    mark_type, mark_text, confirm_time,consumption_time,consumption_time, comments_count, refund_status,name,phone
  </sql>
  <select id="selectByPrimaryKey" resultMap="order_info_map"  parameterType="java.lang.Long" >
  	select 
 	o.id,o.payed,o.pay_status,o.payment,o.status,o.mark_text, o.phone, o.name,o.createtime,o.consumption_time,o.payment_id,o.company_id,
 	s.tel,s.store_name,s.area,s.addr,s.tel,s.shop_name,s.store_id,
 	od.offer_price,od.remark offer_remark,
 	dd.pic,dd.remark damage_remark,
 	p.part_name,
 	cdo.totalPrice,
 	pc.account_id, pc.login_name,
 	ol.op_name,ol.alttime,ol.behavior,ol.log_text
    from t_painting_orders o
    left join t_business_storemanger s on o.store_id = s.store_id
    left join t_car_damage_offer cdo on cdo.id = o.car_damage_offer_id
    left join t_car_damage_offer_detail od on od.car_damage_offer_id = o.car_damage_offer_id
    left join t_car_damage_detail dd on dd.id = od.car_damage_detail_id
    left join t_car_part p on p.id = dd.car_part_id
	left join t_pam_account pc on pc.account_id = o.account_id	
	left join t_order_log ol on ol.order_id =  o.id
    where o.id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jun 04 10:40:13 CST 2015.
    -->
    delete from t_painting_orders
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.cnit.yoyo.model.painting.PaintingOrders" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jun 04 10:40:13 CST 2015.
    -->
    insert into t_painting_orders (id, createtime, car_damage_id, 
      car_damage_offer_id, store_id, store_name, 
      last_modified, payment, payment_id, 
      status,pay_status, confirm, tostr, 
      score_u, score_g, payed, 
      memo, disabled, mark_type, 
      mark_text, confirm_time, consumption_time, comments_count, 
      refund_status)
    values (#{id,jdbcType=BIGINT}, #{createtime,jdbcType=TIMESTAMP}, #{carDamageId,jdbcType=INTEGER}, 
      #{carDamageOfferId,jdbcType=INTEGER}, #{storeId,jdbcType=INTEGER}, #{storeName,jdbcType=VARCHAR}, 
      #{lastModified,jdbcType=TIMESTAMP}, #{payment,jdbcType=VARCHAR}, #{paymentId,jdbcType=INTEGER}, 
      #{status,jdbcType=VARCHAR}, {#payStatus,jdbcType=VARCHAR}, #{confirm,jdbcType=VARCHAR}, #{tostr,jdbcType=VARCHAR}, 
      #{scoreU,jdbcType=VARCHAR}, #{scoreG,jdbcType=VARCHAR}, #{payed,jdbcType=DECIMAL}, 
      #{memo,jdbcType=VARCHAR}, #{disabled,jdbcType=VARCHAR}, #{markType,jdbcType=VARCHAR}, 
      #{markText,jdbcType=VARCHAR}, #{confirmTime,jdbcType=TIMESTAMP}, #{commentsCount,jdbcType=INTEGER}, 
      #{refundStatus,jdbcType=VARCHAR}), #{consumptionTime,jdbcType=TIMESTAMP}
  </insert>
  <insert id="insertSelective" parameterType="com.cnit.yoyo.model.painting.PaintingOrders" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jun 04 10:40:13 CST 2015.
    -->
    insert into t_painting_orders
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="createtime != null" >
        createtime,
      </if>
      <if test="carDamageId != null" >
        car_damage_id,
      </if>
      <if test="carDamageOfferId != null" >
        car_damage_offer_id,
      </if>
      <if test="storeId != null" >
        store_id,
      </if>
      <if test="storeName != null" >
        store_name,
      </if>
      <if test="lastModified != null" >
        last_modified,
      </if>
      <if test="payment != null" >
        payment,
      </if>
      <if test="paymentId != null" >
        payment_id,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="payStatus != null" >
        pay_status,
      </if>
      <if test="confirm != null" >
        confirm,
      </if>
      <if test="tostr != null" >
        tostr,
      </if>
      <if test="scoreU != null" >
        score_u,
      </if>
      <if test="scoreG != null" >
        score_g,
      </if>
      <if test="payed != null" >
        payed,
      </if>
      <if test="memo != null" >
        memo,
      </if>
      <if test="disabled != null" >
        disabled,
      </if>
      <if test="markType != null" >
        mark_type,
      </if>
      <if test="markText != null" >
        mark_text,
      </if>
      <if test="confirmTime != null" >
        confirm_time,
      </if>
      <if test="consumptionTime != null" >
        consumption_time,
      </if>
      <if test="commentsCount != null" >
        comments_count,
      </if>
      <if test="refundStatus != null" >
        refund_status,
      </if>
      <if test="name != null" >
        name,
      </if>
      <if test="phone != null" >
        phone,
      </if>
      <if test="memberId != null" >
        member_id,
      </if>
      <if test="accountId != null" >
        account_id,
      </if>
      <if test="source != null" >
        source,
      </if>
      <if test="companyId != null" >
        company_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="createtime != null" >
        #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="carDamageId != null" >
        #{carDamageId,jdbcType=INTEGER},
      </if>
      <if test="carDamageOfferId != null" >
        #{carDamageOfferId,jdbcType=INTEGER},
      </if>
      <if test="storeId != null" >
        #{storeId,jdbcType=INTEGER},
      </if>
      <if test="storeName != null" >
        #{storeName,jdbcType=VARCHAR},
      </if>
      <if test="lastModified != null" >
        #{lastModified,jdbcType=TIMESTAMP},
      </if>
      <if test="payment != null" >
        #{payment,jdbcType=VARCHAR},
      </if>
      <if test="paymentId != null" >
        #{paymentId,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="payStatus != null" >
        #{payStatus,jdbcType=VARCHAR},
      </if>
      <if test="confirm != null" >
        #{confirm,jdbcType=VARCHAR},
      </if>
      <if test="tostr != null" >
        #{tostr,jdbcType=VARCHAR},
      </if>
      <if test="scoreU != null" >
        #{scoreU,jdbcType=VARCHAR},
      </if>
      <if test="scoreG != null" >
        #{scoreG,jdbcType=VARCHAR},
      </if>
      <if test="payed != null" >
        #{payed,jdbcType=DECIMAL},
      </if>
      <if test="memo != null" >
        #{memo,jdbcType=VARCHAR},
      </if>
      <if test="disabled != null" >
        #{disabled,jdbcType=VARCHAR},
      </if>
      <if test="markType != null" >
        #{markType,jdbcType=VARCHAR},
      </if>
      <if test="markText != null" >
        #{markText,jdbcType=VARCHAR},
      </if>
      <if test="confirmTime != null" >
        #{confirmTime,jdbcType=TIMESTAMP},
      </if>
      <if test="consumptionTime != null" >
        #{consumptionTime,jdbcType=TIMESTAMP},
      </if>
      <if test="commentsCount != null" >
        #{commentsCount,jdbcType=INTEGER},
      </if>
      <if test="refundStatus != null" >
        #{refundStatus,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="phone != null" >
        #{phone,jdbcType=VARCHAR},
      </if>
      <if test="memberId != null" >
        #{memberId,jdbcType=INTEGER},
      </if>
      <if test="accountId != null" >
        #{accountId,jdbcType=INTEGER},
      </if>
       <if test="source != null" >
        #{source,jdbcType=VARCHAR},
      </if>
      <if test="companyId != null" >
    	#{companyId,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.cnit.yoyo.model.painting.PaintingOrders" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jun 04 10:40:13 CST 2015.
    -->
    update t_painting_orders
    <set >
      <if test="createtime != null" >
        createtime = #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="carDamageId != null" >
        car_damage_id = #{carDamageId,jdbcType=INTEGER},
      </if>
      <if test="carDamageOfferId != null" >
        car_damage_offer_id = #{carDamageOfferId,jdbcType=INTEGER},
      </if>
      <if test="storeId != null" >
        store_id = #{storeId,jdbcType=INTEGER},
      </if>
      <if test="storeName != null" >
        store_name = #{storeName,jdbcType=VARCHAR},
      </if>
      <if test="lastModified != null" >
        last_modified = #{lastModified,jdbcType=TIMESTAMP},
      </if>
      <if test="payment != null" >
        payment = #{payment,jdbcType=VARCHAR},
      </if>
      <if test="paymentId != null" >
        payment_id = #{paymentId,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="payStatus != null" >
        pay_status = #{payStatus,jdbcType=VARCHAR},
      </if>
      <if test="confirm != null" >
        confirm = #{confirm,jdbcType=VARCHAR},
      </if>
      <if test="tostr != null" >
        tostr = #{tostr,jdbcType=VARCHAR},
      </if>
      <if test="scoreU != null" >
        score_u = #{scoreU,jdbcType=VARCHAR},
      </if>
      <if test="scoreG != null" >
        score_g = #{scoreG,jdbcType=VARCHAR},
      </if>
      <if test="payed != null" >
        payed = #{payed,jdbcType=DECIMAL},
      </if>
      <if test="memo != null" >
        memo = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="disabled != null" >
        disabled = #{disabled,jdbcType=VARCHAR},
      </if>
      <if test="markType != null" >
        mark_type = #{markType,jdbcType=VARCHAR},
      </if>
      <if test="markText != null" >
        mark_text = #{markText,jdbcType=VARCHAR},
      </if>
      <if test="confirmTime != null" >
        confirm_time = #{confirmTime,jdbcType=TIMESTAMP},
      </if>
      <if test="consumptionTime != null" >
        consumption_time = #{consumptionTime,jdbcType=TIMESTAMP},
      </if>
      <if test="commentsCount != null" >
        comments_count = #{commentsCount,jdbcType=INTEGER},
      </if>
      <if test="refundStatus != null" >
        refund_status = #{refundStatus,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.cnit.yoyo.model.painting.PaintingOrders" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jun 04 10:40:13 CST 2015.
    -->
    update t_painting_orders
    set createtime = #{createtime,jdbcType=TIMESTAMP},
      car_damage_id = #{carDamageId,jdbcType=INTEGER},
      car_damage_offer_id = #{carDamageOfferId,jdbcType=INTEGER},
      store_id = #{storeId,jdbcType=INTEGER},
      store_name = #{storeName,jdbcType=VARCHAR},
      last_modified = #{lastModified,jdbcType=TIMESTAMP},
      payment = #{payment,jdbcType=VARCHAR},
      payment_id = #{paymentId,jdbcType=INTEGER},
      status = #{status,jdbcType=VARCHAR},
      pay_status = #{payStatus,jdbcType=VARCHAR},
      confirm = #{confirm,jdbcType=VARCHAR},
      tostr = #{tostr,jdbcType=VARCHAR},
      score_u = #{scoreU,jdbcType=VARCHAR},
      score_g = #{scoreG,jdbcType=VARCHAR},
      payed = #{payed,jdbcType=DECIMAL},
      memo = #{memo,jdbcType=VARCHAR},
      disabled = #{disabled,jdbcType=VARCHAR},
      mark_type = #{markType,jdbcType=VARCHAR},
      mark_text = #{markText,jdbcType=VARCHAR},
      confirm_time = #{confirmTime,jdbcType=TIMESTAMP},
      consumptio_time = #{consumptionTime,jdbcType=TIMESTAMP},
      comments_count = #{commentsCount,jdbcType=INTEGER},
      refund_status = #{refundStatus,jdbcType=VARCHAR}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
  <select id="selectByDamageId" parameterType="Integer" resultMap="order_info_map">
	select 
 	o.id,o.payed,o.pay_status,o.payment,o.status,o.mark_text,o.name,o.phone,o.consumption_time,
 	s.tel,s.store_name,s.area,s.addr,
 	od.offer_price,
 	dd.pic,
 	p.part_name
    from t_painting_orders o
    left join t_business_storemanger s on o.store_id = s.store_id
    left join t_car_damage_offer_detail od on od.car_damage_offer_id = o.car_damage_offer_id
    left join t_car_damage_detail dd on dd.id = od.car_damage_detail_id
    left join t_car_part p on p.id = dd.car_part_id
    where o.car_damage_id = #{damageId,jdbcType=INTEGER}
    and o.status != 'dead'
  </select>
  
  <resultMap id="order_info_map" type="com.cnit.yoyo.model.painting.PaintingOrders" extends="BaseResultMap">
  	  	<result column="complain_count" property="complainCount"/>
  	  	<result column="relay_count" property="relayCount"/>
  	  	<association property="pamAccount" javaType="com.cnit.yoyo.model.member.PamAccount">
			<id property="account_id" column="accountId"/>
    		<result column="LOGIN_NAME" property="loginName" jdbcType="VARCHAR" />
		</association>
  	  	<association property="carDamageOffer" javaType="com.cnit.yoyo.model.painting.CarDamageOffer">
			<id property="id" column="carDamageOffer_id"/>
    		<result column="totalPrice" property="totalprice" jdbcType="DECIMAL" />
		</association>
		<association property="complain" javaType="com.cnit.yoyo.complain.model.Complain">
			<id property="complainId" column="complain_id"/>
			<result column="complain_id" jdbcType="BIGINT" property="complainId" />
			<result column="c_staus" jdbcType="CHAR" property="status" />
		</association>
	  	<association property="store" javaType="com.cnit.yoyo.model.goods.Store">
	  		<id property="storeId" column="store_id"/>
			<result column="tel" jdbcType="VARCHAR" property="tel" />
			<result column="store_name" property="storeName" jdbcType="VARCHAR" />
		    <result column="area" property="area" jdbcType="VARCHAR" />
		    <result column="addr" property="addr" jdbcType="VARCHAR" />
		    <result column="tel" property="tel" jdbcType="VARCHAR" />
		</association>
		<collection property="logs" ofType="com.cnit.yoyo.model.order.OrderLog">
		    <id column="log_id" jdbcType="INTEGER" property="logId" />
		    <result column="order_id" jdbcType="BIGINT" property="orderId" />
		    <result column="rel_id" jdbcType="BIGINT" property="relId" />
		    <result column="op_id" jdbcType="INTEGER" property="opId" />
		    <result column="op_name" jdbcType="VARCHAR" property="opName" />
		    <result column="alttime" jdbcType="TIMESTAMP" property="alttime" />
		    <result column="bill_type" jdbcType="VARCHAR" property="billType" />
		    <result column="behavior" jdbcType="VARCHAR" property="behavior" />
		    <result column="result" jdbcType="INTEGER" property="result" />
		    <result column="log_text" jdbcType="LONGVARCHAR" property="logText" />
   			<result column="addon" jdbcType="LONGVARCHAR" property="addon" />
		</collection>
		<collection property="damageOfferList" ofType="com.cnit.yoyo.model.painting.CarDamageOfferDetail">
			<id property="id" column="dod_id"/>
			<result column="offer_price" property="offerPrice"/>
			<result column="offer_remark" jdbcType="LONGVARCHAR" property="remark" />
			<association property="carDamageDetail" javaType="com.cnit.yoyo.model.painting.CarDamageDetail">
				<id property="id" column="dd_id"/>
				<result column="pic" jdbcType="VARCHAR" property="pic" />
   				<result column="damage_remark" property="remark" jdbcType="LONGVARCHAR" />
				<association property="carPart" javaType="com.cnit.yoyo.model.painting.CarPart">
					<id property="id" column="p_id"/>
					<result column="part_name" jdbcType="VARCHAR" property="partName" />
				</association>
			</association>
		</collection>
	</resultMap>
	
	<select id="selectList" parameterType="com.cnit.yoyo.model.painting.dto.PaintingOrderDTO" resultMap="order_info_map">
	select o.id, o.createtime, o.store_id, o.store_name, o.payed, o.payment_id, o.status, o.pay_status, o.name, o.phone,o.last_modified,o.account_id,o.source,
	(SELECT count(0) from t_complain complain WHERE complain.order_id=o.id) complain_count,
	(SELECT COUNT(0) from t_order_comment oc WHERE oc.order_id = o.id) relay_count,
	dod.offer_price,dod.id dod_id,
 	dd.pic,dd.id dd_id,
 	p.part_name,p.id p_id,
 	c.status c_staus, c.complain_id,
 	pc.login_name,
 	s.tel,s.store_name,s.area,s.addr
	from t_painting_orders o
	left join t_car_damage_offer_detail dod on dod.car_damage_offer_id = o.car_damage_offer_id
	left join t_car_damage_detail dd on dd.id = car_damage_detail_id
	left join t_car_part p on p.id = dd.car_part_id
	left join t_complain c on c.order_id= o.id
	left join t_pam_account pc on pc.account_id = o.account_id	
	left join t_business_storemanger s on o.store_id = s.store_id
	<where>
		<if test=" ids!=null and ids.size() > 0">
			o.id in
			<foreach collection="ids" item="orderId" index="index" open="(" close=")" separator=",">
				#{orderId}
			</foreach>
		</if>
		<if test="memberId != null and memberId != 0" >
    		and o.member_id = #{memberId}
    	</if>
    	<if test="storeId != null and storeId != 0" >
    		and o.store_id = #{storeId}
    	</if>
		<choose>
			<when test="disabled != null and !''.equals(disabled.trim()) and disabled == 'del'">
				and o.disabled in ('1','2')
			</when>
			<when test="disabled != null and !''.equals(disabled.trim())">
				and o.disabled = #{disabled}
			</when>
		</choose>
		<if test="id != null">
			 and o.id LIKE CONCAT('%', #{id},'%')
		</if>
		<if test="status != null and !''.equals(status.trim())">
			and o.status=#{status}
		</if>
		<if test="payStatus != null and !''.equals(payStatus.trim())">
			and o.pay_status=#{payStatus}
		</if>
		<if test="paymentId != null">
			and o.payment_id = #{paymentId,jdbcType=INTEGER}
		</if>
		<if test="storeName != null and !''.equals(storeName.trim())" >
	        and o.store_name = #{storeName,jdbcType=VARCHAR},
	    </if>
		<if test="name != null and !''.equals(name.trim())" >
	        and o.name = #{name,jdbcType=VARCHAR},
	    </if>
		<if test="storeId != null" >
        	and o.store_id = #{storeId,jdbcType=INTEGER}
      	</if>
      	<choose>
      		<when test=" minPayed != null and maxPayed ==null">
				  and o.payed >= #{minPayed,jdbcType=DECIMAL},
      		</when>
      		<when test=" minPayed == null and maxPayed != null">
      			<![CDATA[
				  and o.payed <= #{maxPayed,jdbcType=DECIMAL},
				]]>
      		</when>
      		<when test=" minPayed != null and maxPayed !=null ">
				 and o.payed BETWEEN #{minPayed,jdbcType=DECIMAL} and #{maxPayed,jdbcType=DECIMAL}
      		</when>
      	</choose>
      	<choose>
      		<when test=" startDate != null and endDate ==null">
				  and DATE_FORMAT(o.createtime, '%Y-%m-%d') >= DATE_FORMAT(#{startDate}, '%Y-%m-%d')
      		</when>
      		<when test=" startDate == null and endDate != null">
      			<![CDATA[
				  and DATE_FORMAT(o.createtime, '%Y-%m-%d') <= DATE_FORMAT(#{endDate}, '%Y-%m-%d')
				]]>
      		</when>
      		<when test=" startDate != null and endDate !=null ">
				  and DATE_FORMAT(o.createtime, '%Y-%m-%d') BETWEEN DATE_FORMAT(#{startDate}, '%Y-%m-%d') and DATE_FORMAT(#{endDate}, '%Y-%m-%d')
      		</when>
      	</choose>
		<choose>
	    	<when test=" createtime != null and beforeOneYear == false ">
	    		<![CDATA[
				  and DATE_FORMAT(o.createtime, '%Y-%m-%d') >= DATE_FORMAT(#{createtime}, '%Y-%m-%d')
				]]>
	    	</when>
	    	<when test=" createtime != null and beforeOneYear == true ">
	    		<![CDATA[
				  and DATE_FORMAT(o.createtime, '%Y-%m-%d') < DATE_FORMAT(#{createtime}, '%Y-%m-%d')
				]]>
	    	</when>
	    </choose>
    </where>
     ORDER BY o.createtime DESC
	</select>
	
	<select id="selectOrderIdsList" parameterType="com.cnit.yoyo.model.painting.dto.PaintingOrderDTO" resultType="java.lang.Long">
		select o.id
		from t_painting_orders o
		<where>
			<if test="memberId != null and memberId != 0" >
	    		o.member_id = #{memberId}
	    	</if>
	    	<if test="storeId != null and storeId != 0" >
	    		and o.store_id = #{storeId}
	    	</if>
			<choose>
				<when test="disabled != null and !''.equals(disabled.trim()) and disabled == 'del'">
					and o.disabled in ('1','2')
				</when>
				<when test="disabled != null and !''.equals(disabled.trim())">
					and o.disabled = #{disabled}
				</when>
			</choose>
			<if test="id != null">
				 and o.id LIKE CONCAT('%', #{id},'%')
			</if>
			<if test="status != null and !''.equals(status.trim())">
				and o.status=#{status}
			</if>
			<if test="payStatus != null and !''.equals(payStatus.trim())">
				and o.pay_status=#{payStatus}
			</if>
			<if test="paymentId != null">
				and o.payment_id = #{paymentId,jdbcType=INTEGER}
			</if>
			<if test="storeName != null and !''.equals(storeName.trim())" >
		        and o.store_name = #{storeName,jdbcType=VARCHAR},
		    </if>
			<if test="name != null and !''.equals(name.trim())" >
		        and o.name = #{name,jdbcType=VARCHAR},
		    </if>
			<if test="storeId != null" >
	        	and o.store_id = #{storeId,jdbcType=INTEGER}
	      	</if>
	      	<choose>
	      		<when test=" minPayed != null and maxPayed ==null">
					  and o.payed >= #{minPayed,jdbcType=DECIMAL},
	      		</when>
	      		<when test=" minPayed == null and maxPayed != null">
	      			<![CDATA[
					  and o.payed <= #{maxPayed,jdbcType=DECIMAL},
					]]>
	      		</when>
	      		<when test=" minPayed != null and maxPayed !=null ">
					 and o.payed BETWEEN #{minPayed,jdbcType=DECIMAL} and #{maxPayed,jdbcType=DECIMAL}
	      		</when>
	      	</choose>
	      	<choose>
	      		<when test=" startDate != null and endDate ==null">
					  and DATE_FORMAT(o.createtime, '%Y-%m-%d') >= DATE_FORMAT(#{startDate}, '%Y-%m-%d')
	      		</when>
	      		<when test=" startDate == null and endDate != null">
	      			<![CDATA[
					  and DATE_FORMAT(o.createtime, '%Y-%m-%d') <= DATE_FORMAT(#{endDate}, '%Y-%m-%d')
					]]>
	      		</when>
	      		<when test=" startDate != null and endDate !=null ">
					  and DATE_FORMAT(o.createtime, '%Y-%m-%d') BETWEEN DATE_FORMAT(#{startDate}, '%Y-%m-%d') and DATE_FORMAT(#{endDate}, '%Y-%m-%d')
	      		</when>
	      	</choose>
			<choose>
		    	<when test=" createtime != null and beforeOneYear == false ">
		    		<![CDATA[
					  and DATE_FORMAT(o.createtime, '%Y-%m-%d') >= DATE_FORMAT(#{createtime}, '%Y-%m-%d')
					]]>
		    	</when>
		    	<when test=" createtime != null and beforeOneYear == true ">
		    		<![CDATA[
					  and DATE_FORMAT(o.createtime, '%Y-%m-%d') < DATE_FORMAT(#{createtime}, '%Y-%m-%d')
					]]>
		    	</when>
		    </choose>
		</where>
		 ORDER BY o.createtime DESC
	</select>
	
	<update id="updateStatus" parameterType="com.cnit.yoyo.model.painting.PaintingOrders" >
		UPDATE t_painting_orders
		    <set >
      <if test="createtime != null" >
        createtime = #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="carDamageId != null" >
        car_damage_id = #{carDamageId,jdbcType=INTEGER},
      </if>
      <if test="carDamageOfferId != null" >
        car_damage_offer_id = #{carDamageOfferId,jdbcType=INTEGER},
      </if>
      <if test="storeId != null" >
        store_id = #{storeId,jdbcType=INTEGER},
      </if>
      <if test="storeName != null" >
        store_name = #{storeName,jdbcType=VARCHAR},
      </if>
      <if test="lastModified != null" >
        last_modified = #{lastModified,jdbcType=TIMESTAMP},
      </if>
      <if test="payment != null" >
        payment = #{payment,jdbcType=VARCHAR},
      </if>
      <if test="paymentId != null" >
        payment_id = #{paymentId,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="payStatus != null" >
        pay_status = #{payStatus,jdbcType=VARCHAR},
      </if>
      <if test="confirm != null" >
        confirm = #{confirm,jdbcType=VARCHAR},
      </if>
      <if test="tostr != null" >
        tostr = #{tostr,jdbcType=VARCHAR},
      </if>
      <if test="scoreU != null" >
        score_u = #{scoreU,jdbcType=VARCHAR},
      </if>
      <if test="scoreG != null" >
        score_g = #{scoreG,jdbcType=VARCHAR},
      </if>
      <if test="payed != null" >
        payed = #{payed,jdbcType=DECIMAL},
      </if>
      <if test="memo != null" >
        memo = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="disabled != null" >
        disabled = #{disabled,jdbcType=VARCHAR},
      </if>
      <if test="markType != null" >
        mark_type = #{markType,jdbcType=VARCHAR},
      </if>
      <if test="markText != null" >
        mark_text = #{markText,jdbcType=VARCHAR},
      </if>
      <if test="confirmTime != null" >
        confirm_time = #{confirmTime,jdbcType=TIMESTAMP},
      </if>
      <if test="consumptionTime != null" >
        consumption_time = #{consumptionTime,jdbcType=TIMESTAMP},
      </if>
      <if test="commentsCount != null" >
        comments_count = #{commentsCount,jdbcType=INTEGER},
      </if>
      <if test="refundStatus != null" >
        refund_status = #{refundStatus,jdbcType=VARCHAR},
      </if>
    </set>
    where id IN
	<foreach collection="ids" item="orderId" index="index" open="(" close=")" separator=",">
		#{orderId}
	</foreach>
	</update> 
	
	
  <select id="selectByOrderAndMem" parameterType="map" resultType="Integer">
	select count(0)
    from t_painting_orders o
    where o.car_damage_id = #{damageId,jdbcType=INTEGER}
    and o.member_id = #{memberId,jdbcType=INTEGER}
    and o.status != 'dead';
  </select>
  
    <select id="selectPermission" parameterType="Long" resultType="Integer">
		SELECT count(0)
		FROM t_company_region
		WHERE company_id = #{_parameter,jdbcType=BIGINT}
		AND cat_id = (
			SELECT region_id
			FROM t_company_region_cat
			WHERE region_name LIKE '%钣金喷漆%'
		);
 	</select>
 	
 	<select id="selectStatus" resultType="String">
	  SELECT t.status
	  FROM t_painting_orders t
	  WHERE t.id in
	  <foreach item="orderId" index="index" collection="list" open="(" separator="," close=")">
	        #{orderId}
	  </foreach>
	</select>
</mapper>