<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cnit.yoyo.dao.car.CarMaintainMapper" >
  <resultMap id="BaseResultMap" type="com.cnit.yoyo.model.car.CarMaintain" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 16:08:45 CST 2015.
    -->
    <id column="maintain_id" property="maintainId" jdbcType="INTEGER" />
    <result column="CarID" property="carId" jdbcType="INTEGER" />
    <result column="maintain_time" property="maintainTime" jdbcType="INTEGER" />
    <result column="maintain_km" property="maintainKm" jdbcType="VARCHAR" />
    <result column="car_trip_range" property="carTripRange" jdbcType="INTEGER" />
    <result column="purchase_time" property="purchaseTime" jdbcType="INTEGER" />
    <result column="first_maintain_time" property="firstMaintainTime" jdbcType="INTEGER" />
    <result column="first_maintain_km" property="firstMaintainKm" jdbcType="INTEGER" />
    <result column="sort" property="sort" jdbcType="INTEGER" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="disabled" property="disabled" jdbcType="VARCHAR" />
    <result column="car_brand" property="carBrand" jdbcType="INTEGER" />
    <result column="car_factory" property="carFactory" jdbcType="INTEGER" />
    <result column="car_dept" property="carDept" jdbcType="INTEGER" />
    <result column="official_maintain" property="officialMaintain" jdbcType="VARCHAR" />
    <result column="optional_maintain" property="optionalMaintain" jdbcType="VARCHAR" />
    <result column="crawler_id" property="crawlerId" jdbcType="INTEGER" />
  </resultMap>
  
  
   <resultMap extends="BaseResultMap" id="BaseDTOResultMap" type="com.cnit.yoyo.model.car.dto.CarMaintainDTO">
    <result column="car_dept_name" jdbcType="VARCHAR" property="carDeptName" />
  </resultMap>
  
   <sql id="Base_dto_Column_List">
       carName
  </sql>
  
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 16:08:45 CST 2015.
    -->
    maintain_id, CarID, maintain_time,maintain_km, car_trip_range, purchase_time, first_maintain_time, first_maintain_km, 
    sort, remark, disabled,	car_brand,car_factory,car_dept,official_maintain,optional_maintain,crawler_id
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 16:08:45 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_car_maintain_cycle
    where maintain_id = #{maintainId,jdbcType=INTEGER}
  </select>
  
  <select id="selectByCarId" resultType="java.lang.Integer" parameterType="java.lang.Integer">
    select CarID from t_car_maintain_cycle
    where CarID in
    <foreach item="idItem" collection="array" open="(" separator="," close=")">
		#{idItem}
	</foreach>
  </select>
  
  <insert id="insert" parameterType="com.cnit.yoyo.model.car.CarMaintain" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 16:08:45 CST 2015.
    -->
    insert into t_car_maintain_cycle (maintain_id, CarID, maintain_km, maintain_time,
      car_trip_range, purchase_time, first_maintain_time, 
      first_maintain_km, sort, remark, 
      disabled)
    values (#{maintainId,jdbcType=INTEGER}, #{carId,jdbcType=INTEGER}, #{maintain_km,jdbcType=VARCHAR}, maintain_time = #{maintainTime,jdbcType=INTEGER},
      #{carTripRange,jdbcType=INTEGER}, #{purchaseTime,jdbcType=INTEGER}, #{firstMaintainTime,jdbcType=INTEGER}, 
      #{firstMaintainKm,jdbcType=INTEGER}, #{sort,jdbcType=INTEGER}, #{remark,jdbcType=VARCHAR}, 
      #{disabled,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.cnit.yoyo.model.car.dto.CarMaintainDTO" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 16:08:45 CST 2015.
    -->
    insert into t_car_maintain_cycle
    <trim prefix="(" suffix=")" suffixOverrides="," >
    
      <if test="carId != null" >
        CarID,
      </if>
      <if test="maintainKm != null  " >
        maintain_km,
      </if>
      <if test="carTripRange != null" >
        car_trip_range,
      </if>
      <if test="purchaseTime != null" >
        purchase_time,
      </if>
      <if test="firstMaintainTime != null" >
        first_maintain_time,
      </if>
      <if test="firstMaintainKm != null" >
        first_maintain_km,
      </if>
      <if test="maintainTime != null" >
      	maintain_time,
      </if>
      <if test="carBrand != null">
      	car_brand,
      </if>
	  <if test="carFactory != null">
	  	car_factory,
	  </if>
	  <if test="carDept != null">
	  	car_dept,
	  </if>
	  <if test="officialMaintain != null">
	  	official_maintain,
	  </if>
	  <if test="optionalMaintain != null">
	  	optional_maintain,
	  </if>
      <if test="sort != null" >
        sort,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="disabled != null and disabled!=''" >
        disabled,
      </if>
      <if test="crawlerId != null" >
        crawler_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
     
      <if test="carId != null" >
        #{carId,jdbcType=INTEGER},
      </if>
      <if test="maintainKm != null" >
        #{maintainKm,jdbcType=VARCHAR},
      </if>
      <if test="maintainTime != null" >
      	#{maintainTime,jdbcType=INTEGER},
      </if>
      <if test="carTripRange != null" >
        #{carTripRange,jdbcType=INTEGER},
      </if>
      <if test="purchaseTime != null" >
        #{purchaseTime,jdbcType=INTEGER},
      </if>
      <if test="firstMaintainTime != null" >
        #{firstMaintainTime,jdbcType=INTEGER},
      </if>
      <if test="firstMaintainKm != null" >
        #{firstMaintainKm,jdbcType=INTEGER},
      </if>
      <if test="carBrand != null">
      	#{carBrand,jdbcType=INTEGER},
      </if>
	  <if test="carFactory != null">
	  	#{carFactory,jdbcType=INTEGER},
	  </if>
	  <if test="carDept != null">
	  	#{carDept,jdbcType=INTEGER},
	  </if>
	  <if test="officialMaintain != null">
	  	#{officialMaintain,jdbcType=VARCHAR},
	  </if>
	  <if test="optionalMaintain != null">
	  	#{optionalMaintain,jdbcType=VARCHAR},
	  </if>
      <if test="sort != null" >
        #{sort,jdbcType=INTEGER},
      </if>
      <if test="remark != null " >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="disabled != null and disabled!=''" >
        #{disabled,jdbcType=VARCHAR},
      </if>
      <if test="crawlerId != null" >
        #{crawlerId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.cnit.yoyo.model.car.dto.CarMaintainDTO" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 16:08:45 CST 2015.
    -->
    update t_car_maintain_cycle
    <set >
      <if test="carId != null" >
        CarID = #{carId,jdbcType=INTEGER},
      </if>
      <if test="maintainKm != null" >
        maintain_km = #{maintainKm,jdbcType=VARCHAR},
      </if>
      <if test="maintainTime != null" >
      	maintain_time = #{maintainTime,jdbcType=INTEGER},
      </if>
      <if test="carTripRange != null" >
        car_trip_range = #{carTripRange,jdbcType=INTEGER},
      </if>
      <if test="purchaseTime != null" >
        purchase_time = #{purchaseTime,jdbcType=INTEGER},
      </if>
      <if test="firstMaintainTime != null" >
        first_maintain_time = #{firstMaintainTime,jdbcType=INTEGER},
      </if>
      <if test="firstMaintainKm != null" >
        first_maintain_km = #{firstMaintainKm,jdbcType=INTEGER},
      </if>
       <if test="carBrand != null">
      	car_brand=#{carBrand,jdbcType=INTEGER},
      </if>
	  <if test="carFactory != null">
	  	car_factory=#{carFactory,jdbcType=INTEGER},
	  </if>
	  <if test="carDept != null">
	  	car_dept=#{carDept,jdbcType=INTEGER},
	  </if>
	  <if test="officialMaintain != null">
	  	official_maintain=#{officialMaintain,jdbcType=VARCHAR},
	  </if>
	  <if test="optionalMaintain != null">
	  	optional_maintain=#{optionalMaintain,jdbcType=VARCHAR},
	  </if>
      <if test="sort != null" >
        sort = #{sort,jdbcType=INTEGER},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="disabled != null and disabled!=''" >
        disabled = #{disabled,jdbcType=VARCHAR},
      </if>
    </set>
    where maintain_id = #{maintainId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.cnit.yoyo.model.car.CarMaintain" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 16:08:45 CST 2015.
    -->
    update t_car_maintain_cycle
    set CarID = #{carId,jdbcType=INTEGER},
      maintain_km = #{maintainKm,jdbcType=VARCHAR},
      maintain_time = #{maintainTime,jdbcType=INTEGER},
      car_trip_range = #{carTripRange,jdbcType=INTEGER},
      purchase_time = #{purchaseTime,jdbcType=INTEGER},
      first_maintain_time = #{firstMaintainTime,jdbcType=INTEGER},
      first_maintain_km = #{firstMaintainKm,jdbcType=INTEGER},
      sort = #{sort,jdbcType=INTEGER},
      remark = #{remark,jdbcType=VARCHAR},
      disabled = #{disabled,jdbcType=VARCHAR}
    where maintain_id = #{maintainId,jdbcType=INTEGER}
  </update>

   <select id="findList" resultMap="BaseDTOResultMap" parameterType="com.cnit.yoyo.model.car.dto.CarMaintainDTO" >
	    select 
	    	<include refid="Base_Column_List" />,
	    	dept.car_dept_name 
	    from 
	   	 t_car_maintain_cycle tcmc 
	    join t_car_dept dept on tcmc.car_dept = dept.car_dept_id
	    where  
	    	tcmc.disabled='0' 
	    <if test="carId !=null and carId!=0" >
	       and  CarID = #{carId,jdbcType=INTEGER}
	    </if>
	    <if test="maintainKm != null and maintainKm !=''" >
	        and  maintain_km LIKE CONCAT('%', #{maintainKm,jdbcType=VARCHAR},'%') 
	    </if>
	     <if test="carTripRange != null and carTripRange!=0 " >
	        and  car_trip_range = #{carTripRange,jdbcType=INTEGER}
	    </if>
	    
	     <if test="purchaseTime != null and purchaseTime!=0 " >
            and  purchase_time = #{purchaseTime,jdbcType=INTEGER}
        </if>
        
         <if test="firstMaintainTime != null and firstMaintainTime!=0 " >
            and  first_maintain_time = #{firstMaintainTime,jdbcType=INTEGER}
        </if>
         <if test="firstMaintainKm != null and firstMaintainKm!=0 " >
            and  first_maintain_km = #{firstMaintainKm,jdbcType=INTEGER}
        </if>
        <if test="carBrand != null and carBrand > 0" >
        	and car_brand=#{carBrand,jdbcType=INTEGER}
        </if>
        <if test="carFactory != null and carFactory > 0 " >
        	and car_factory=#{carFactory,jdbcType=INTEGER}
        </if>
        <if test="carDept != null and carDept > 0 " >
        	and car_dept=#{carDept,jdbcType=INTEGER}
        </if>
        group by tcmc.car_dept
  </select>
  <!-- 查找是否有同名的 (修改时，需要除开本身)-->
  <select id="findByCarIdandName" resultType="java.lang.Integer" parameterType="com.cnit.yoyo.model.car.dto.CarMaintainDTO">
        select count(maintain_id) from t_car_maintain_cycle 
        where disabled='0' and CarID = #{carId,jdbcType=INTEGER} and  maintain_km = #{maintainKm,jdbcType=VARCHAR}
        <if test="maintainId !=null and maintainId !=0 ">
             and maintain_id != #{maintainId,jdbcType=INTEGER}
        </if>
  </select>
  
  <!-- 删除保养周期 -->
  <update id="deleteByPrimaryKey" >
 
    update t_car_maintain_cycle set disabled='1' 
    where maintain_id in
        <foreach collection="array" item="id" index="index"
            open="(" close=")" separator=",">
            #{id}
        </foreach>
  </update>
  
  <select id="selectCarmaintainByCarId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
  	SELECT 
  	<include refid="Base_Column_List" /> 
  	FROM 
  	t_car_maintain_cycle WHERE CarID=#{carId};
  </select>
  <resultMap type="com.cnit.yoyo.model.car.dto.CarMaintainReferenceDTO" id="CarMaintainReferenceMap" extends="BaseResultMap">
  		<result column="maint_status" property="maintStatus" jdbcType="INTEGER" />
		<result column="crawler_id" property="crawlerId" jdbcType="INTEGER" />
	    <result column="crawler_maintain_km" property="crawlerMaintainKm" jdbcType="INTEGER" />
	    <result column="crawler_maintain_time" property="crawlerMaintainTime" jdbcType="INTEGER" />
	    <result column="crawler_official_maintain" property="crawlerOfficialMaintain" jdbcType="VARCHAR" />
	    <result column="cycle_car_name" property="cycleCarName" jdbcType="VARCHAR" />
	    <result column="crawler_car_name" property="crawlerCarName" jdbcType="VARCHAR" />
	    <result column="crawler_car_id" property="crawlerCarId" jdbcType="VARCHAR" />
	    <result column="num" property="num" jdbcType="INTEGER" />
  </resultMap>
  
  <select id="selectCarMaintainCount" resultType="java.util.HashMap">
	  	SELECT 	
			SUM(CASE c.cycle WHEN 'cycle' THEN c.num END) AS 'cycle',
			SUM(CASE c.cycle WHEN 'crawler' THEN c.num END) AS 'crawler'
		FROM (
			SELECT COUNT(0) AS num,"cycle" from t_car_maintain_cycle
			UNION ALL
			SELECT COUNT(0) AS num,"crawler" FROM t_car_maintain_cycle_web_crawler
		) c
  </select>
  
  <select id="selectCarMaintainReference" parameterType="com.cnit.yoyo.model.car.dto.CarMaintainReferenceDTO" resultMap="CarMaintainReferenceMap">
	   SELECT
		cycle.maintain_id,
		cycle.CarID,
		cycle.car_factory,
		cycle.car_dept,
		cycle.maintain_time,
		cycle.maintain_km,
		cycle.official_maintain,
		cycle.optional_maintain,		
		cycle_car.car_name as cycle_car_name,		
		(CASE WHEN cycle.maintain_id IS NULL THEN 0 ELSE 1 END) maint_status,
		crawler.crawler_id,
		crawler.maintain_km crawler_maintain_km,
		crawler.maintain_time as crawler_maintain_time,
		crawler.official_maintain as crawler_official_maintain,
		crawler_car.car_name as crawler_car_name,
		crawler_car.car_id as crawler_car_id
	FROM
		t_car_maintain_cycle_web_crawler crawler
	<choose> 
		<when test="invert==true">RIGHT JOIN</when> 
		<otherwise>LEFT JOIN</otherwise> 
	</choose> 
	t_car_maintain_cycle cycle ON cycle.crawler_id = crawler.crawler_id
	LEFT JOIN t_car crawler_car ON crawler_car.car_id=crawler.car_id
	LEFT JOIN t_car cycle_car ON cycle_car.car_id=cycle.CarID
	where 1=1
	<if test="carBrand !=null and carBrand > 0">
		and cycle.car_brand=#{carBrand,jdbcType=INTEGER}
	</if>
	<if test="carFactory !=null and carFactory > 0">
		and cycle.car_factory=#{carFactory,jdbcType=INTEGER}
	</if>
		<if test="carDept !=null and carDept > 0">
		and cycle.car_dept=#{carDept,jdbcType=INTEGER}
	</if>
		<if test="carId !=null and carId > 0">
		and cycle.carId=#{carId,jdbcType=INTEGER}
	</if>
  </select>
  
  	<!-- 卖家中心-设置保养商品  获取所有保养周期 -->
    <select id="selectCarMaintainByParam" parameterType="com.cnit.yoyo.model.car.dto.CarMaintainReferenceDTO" resultMap="CarMaintainReferenceMap">
	     select * from(
	     SELECT	cycle.maintain_id,
		cycle.CarID,
		cycle.car_factory,
		cycle.car_dept,
		cycle.maintain_time,
		cycle.maintain_km,
		cycle.official_maintain,
		cycle.optional_maintain,		
		cycle_car.car_name as cycleCarName,
		(SELECT count(*) from t_maintain_default_goods tmdg WHERE tmdg.maintain_id=cycle.maintain_id 
		AND tmdg.company_id=#{companyId,jdbcType=VARCHAR} ) as num 
	FROM
		t_car_maintain_cycle cycle
		LEFT JOIN t_car cycle_car ON cycle_car.car_id=cycle.CarID
		where 1=1
	<if test="carBrand !=null and carBrand > 0">
		and cycle.car_brand=#{carBrand,jdbcType=INTEGER}
	</if>
	<if test="carFactory !=null and carFactory > 0">
		and cycle.car_factory=#{carFactory,jdbcType=INTEGER}
	</if>
		<if test="carDept !=null and carDept > 0">
		and cycle.car_dept=#{carDept,jdbcType=INTEGER}
	</if>
	<if test="carId !=null and carId > 0">
		and cycle.carId=#{carId,jdbcType=INTEGER}
	</if>
	) as a where 1=1 
	<if test="num!=null">
		<choose>
			<when test="num>0">
				and a.num>0
			</when>
			<when test="num==0">
				and a.num=0
			</when>
		</choose>
		
	</if>
	order by a.cycleCarName asc
  </select>
  
   <resultMap id="carMaintainGoodsMap" type="com.cnit.yoyo.model.car.dto.CarMaintainGoodsDTO" >
    <id column="id" property="maintainItemId" jdbcType="INTEGER" />
    <result column="CAT_NAME" property="maintainItemName" jdbcType="VARCHAR" />
    <result column="CATALOG_NAME" property="maintainAccName" jdbcType="VARCHAR" />
    <result column="CAT_ID" property="goodsCateId" jdbcType="INTEGER" />
    <result column="defaultName" property="defaultName" jdbcType="VARCHAR" />
    <result column="defaultProductId" property="defaultProductId" jdbcType="INTEGER" />
  </resultMap>
  
  <!-- 卖家中心-设置保养商品  获取保养配件-->
    <select id="findCarMaintainItemByIds"  resultMap="carMaintainGoodsMap">
	    SELECT tgc.CAT_NAME,ta.CATALOG_NAME,tc.id ,ta.CAT_ID,
	   ( SELECT tp.name FROM t_maintain_default_goods tmdg  JOIN t_products tp ON tmdg.goods_id=tp.product_id WHERE tmdg.acc_id=tc.id AND tmdg.company_id=#{companyId} AND tmdg.maintain_id=#{maintianId}) as defaultName,
	   ( SELECT tmdg.goods_id FROM t_maintain_default_goods tmdg  WHERE tmdg.acc_id=tc.id AND tmdg.company_id=#{companyId} AND tmdg.maintain_id=#{maintianId}) as defaultProductId
	    from t_goods_cat tgc JOIN t_car_maintain_accessory tc ON
		tgc.CAT_ID=tc.category_id 
		JOIN t_accessory_catalog ta ON tc.acc_id=ta.CATALOG_ID
		where tc.disabled='0' and tgc.CAT_ID in 
		<foreach collection="ids" index="index" item="item" open="(" close=")" separator=",">
			${item}
		</foreach>
	order by tgc.CAT_ID asc
  </select>
  
  <select id="selectCarMaintain" resultMap="BaseResultMap" parameterType="com.cnit.yoyo.model.car.dto.CarMaintainQryDTO">
  	SELECT
  	<include refid="Base_Column_List" />
  	FROM 
  		t_car_maintain_cycle 
  	where CarID=#{carId} AND maintain_time>${maintainMonth} AND maintain_km>${maintainKm} ORDER BY maintain_km ASC LIMIT 1  
  </select>
  
  
  <select id="selectMaintainCompany" resultType="com.cnit.yoyo.model.car.dto.MaintainCompanyDTO" parameterType="com.cnit.yoyo.model.car.dto.CarMaintainQryDTO">
	SELECT 
		m.accId,
		m.companyId,
		m.companyName,
		m.companyTel,
		m.companyArea,
		m.companyAddr,
		COUNT(0) 
	FROM(
		SELECT
			company.company_id as companyId,
			company.store_name as companyName,
			company.company_ctel as companyTel,
			company.company_carea as companyArea,
			company.company_caddr as companyAddr,
			mdg.acc_id accId
		FROM
			t_company company
			JOIN t_maintain_default_goods mdg ON company.company_id = mdg.company_id
		WHERE
			mdg.disabled = 0
		AND mdg.maintain_id = ${maintainId}
		<if test="area!=null and area!=''">
		    AND company.company_carea LIKE CONCAT('%', #{area,jdbcType=VARCHAR},'%') 
	   </if>
		
		AND mdg.acc_id IN <foreach collection="ids" index="index" item="item" open="(" close=")" separator=",">${item}</foreach>
	) m
		GROUP BY m.companyId
		HAVING COUNT(0) = ${accCount};
  </select>
  
  <select id="selectDefautlGoods" resultType="com.cnit.yoyo.model.car.dto.MaintainProductDTO" parameterType="com.cnit.yoyo.model.car.dto.CarMaintainQryDTO">
  	SELECT
		mdg.id,
		mdg.acc_id accId,	
		product.`NAME` productName,
		product.product_id productId,
		product.goods_id goodsId,		
		product.store,
		product.price,
		product.marketable,
		product.disabled,
		goods.STORE_ID storeId,
		goods.COMPANY_ID companyId,
		product.picture_path picturePath,		
		cat.CAT_NAME catName,
		cat.CAT_ID catId,
		catalog.CATALOG_ID categoryId,
		catalog.CATALOG_NAME catalogName
	FROM
		t_maintain_default_goods mdg
	LEFT JOIN t_products product on mdg.goods_id=product.product_id
	LEFT JOIN t_goods goods ON product.goods_id=goods.GOODS_ID
	left JOIN t_car_maintain_accessory cma on mdg.acc_id=cma.id
	LEFT JOIN t_goods_cat cat ON cma.category_id=cat.CAT_ID
	LEFT JOIN t_accessory_catalog catalog ON catalog.CATALOG_ID=cma.acc_id
	WHERE 1=1
	<if test="companyId!=null">
		AND mdg.COMPANY_ID=#{companyId}
	</if>
	AND mdg.MAINTAIN_ID=#{maintainId}
	AND product.marketable=1
	AND product.disabled=0
	AND mdg.acc_id in <foreach collection="ids" index="index" item="item" open="(" close=")" separator=",">${item}</foreach>
  </select>
  
     <!-- 根据分类查询保养配件 -->
   <select id="findAccessoryByCatId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
	    SELECT
			accessory.id,	
			cat.CAT_ID,
			cat.CAT_NAME,
			catalog.CATALOG_ID,
			catalog.CATALOG_NAME
		FROM
			t_car_maintain_accessory accessory
		LEFT JOIN t_goods_cat cat ON accessory.category_id = cat.CAT_ID
		LEFT JOIN t_accessory_catalog catalog ON accessory.acc_id = catalog.CATALOG_ID
		WHERE accessory.disabled=0 AND category_id in <foreach collection="mainitanCatgoryId" index="index" item="item" open="(" close=")" separator=",">${item}</foreach>
   </select>
   
  <resultMap type="com.cnit.yoyo.model.car.dto.MaintainAccessoryItemsDTO" id="MaintainAccessoryDTOResult">
  	<result column="CAT_ID" property="catId"/>
  	<result column="CAT_NAME" property="catName"/>
  	<collection property="maintainAccessorys" ofType="com.cnit.yoyo.model.car.dto.MaintainAccessoryItemsDTO">
  		<result column="CATALOG_ID" property="catalogId"/>
  		<result column="CATALOG_NAME" property="catalogName"/>
  		<result column="id" property="id"/>
  	</collection>
  </resultMap>
  
  <select id="selectMaintainAccessoryItems" resultMap="MaintainAccessoryDTOResult">
	SELECT
		accessory.id,	
		cat.CAT_ID,
		cat.CAT_NAME,
		catalog.CATALOG_ID,
		catalog.CATALOG_NAME
	FROM
		t_car_maintain_accessory accessory
	LEFT JOIN t_goods_cat cat ON accessory.category_id = cat.CAT_ID
	LEFT JOIN t_accessory_catalog catalog ON accessory.acc_id = catalog.CATALOG_ID
	WHERE 
		accessory.disabled=0 
	AND 
		category_id in <foreach collection="list" index="index" item="item" open="(" close=")" separator=",">${item.id}</foreach>
  </select>
  
  <select id="selectOptionalAccessoriesProduct" resultType="com.cnit.yoyo.model.car.dto.MaintainProductDTO" parameterType="com.cnit.yoyo.model.car.dto.CarMaintainQryDTO">
	  	SELECT
	  		product.`NAME` productName,
			product.product_id productId,
			product.goods_id goodsId,		
			product.store,
			product.price,
			product.marketable,
			product.disabled,
			goods.STORE_ID storeId,
			goods.COMPANY_ID companyId,
			product.picture_path picturePath,
			catalog.catalog_name catalogName,
			catalog.CATALOG_ID categoryId
		FROM
			t_accessory accessory
		JOIN t_accessory_catalog catalog on accessory.CAT_ID=catalog.CATALOG_ID
		JOIN t_goods goods ON accessory.ACC_ID = goods.ACC_ID
		JOIN t_products product ON goods.GOODS_ID=product.goods_id
		WHERE
			goods.DISABLED=0
		AND goods.MARKETABLE=1
		AND goods.COMPANY_ID=${companyId}
		AND accessory.CAT_ID =${categoryId}
		<if test="brandId!=null">
		AND goods.BRAND_ID=${brandId}
		</if>
  </select>
  
    <select id="selectMaintainAccessoryCatalog" resultType="com.cnit.yoyo.model.car.dto.MaintainAccessoryCatalogDTO" parameterType="com.cnit.yoyo.model.car.dto.CarMaintainQryDTO">
		  	SELECT 
		  		CATALOG_ID catalogId,
		  		CATALOG_NAME catalogName 
		  	FROM 
		  		t_accessory_catalog WHERE CATALOG_ID IN			
				<foreach collection="accessoryCategoryIds" index="index" item="item" open="(" close=")" separator=",">${item}</foreach>
 	</select>
  
   <select id="selectOptionalAccessoriesBrand" resultType="com.cnit.yoyo.model.car.dto.MaintainBrandDTO" parameterType="com.cnit.yoyo.model.car.dto.CarMaintainQryDTO">
	    SELECT
			brand.brand_id brandId,
			brand.brand_name brandName
		FROM
			t_accessory accessory
		JOIN t_accessory_catalog catalog on accessory.CAT_ID=catalog.CATALOG_ID
		JOIN t_goods goods ON accessory.ACC_ID = goods.ACC_ID
		JOIN t_brand brand ON goods.BRAND_ID=brand.brand_id
		WHERE
			goods.DISABLED=0
		AND goods.MARKETABLE=1
		AND	goods.COMPANY_ID=${companyId} 
		AND accessory.CAT_ID =${categoryId}
		GROUP BY brand.brand_id
  </select>
</mapper>