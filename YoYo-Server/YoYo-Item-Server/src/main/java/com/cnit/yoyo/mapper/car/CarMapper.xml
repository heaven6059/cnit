<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cnit.yoyo.dao.car.CarMapper">
  <resultMap id="BaseResultMap" type="com.cnit.yoyo.model.car.Car">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 19:29:06 CST 2015.
    -->
    <id column="car_id" jdbcType="INTEGER" property="carId" />
    <result column="car_dept_id" jdbcType="INTEGER" property="carDeptId" />
    <result column="car_name" jdbcType="VARCHAR" property="carName" />
    <result column="keyword" jdbcType="VARCHAR" property="keyword" />
    <result column="icon_file" jdbcType="VARCHAR" property="iconFile" />
    <result column="view_count" jdbcType="INTEGER" property="viewCount" />
    <result column="last_update" jdbcType="TIMESTAMP" property="lastUpdate" />
    <result column="status" jdbcType="VARCHAR" property="status" />
    <result column="price" jdbcType="DECIMAL" property="price" />
    <result column="store_price" jdbcType="DECIMAL" property="storePrice" />
    <result column="filter_id" jdbcType="INTEGER" property="filterId" />
    <result column="isdel" jdbcType="VARCHAR" property="isdel" />
    <result column="isconfig" jdbcType="INTEGER" property="isconfig" />
  </resultMap>
  
  <resultMap id="carConfigResultMap" type="com.cnit.yoyo.model.car.Car" extends="BaseResultMap">
  	<association property="carConfigWithBLOBs" column="car_id" javaType="com.cnit.yoyo.model.car.CarConfigWithBLOBs">
  			<id column="BrandID" jdbcType="INTEGER" property="brandid" />
    		<result column="car_id" jdbcType="INTEGER" property="carId" />
    		<result column="CarGearbox" jdbcType="VARCHAR" property="cargearbox" />
    		<result column="Configs" jdbcType="LONGVARCHAR" property="configs" />
    		<result column="Options" jdbcType="LONGVARCHAR" property="options" />
    		<result column="DealerPrices" jdbcType="LONGVARCHAR" property="dealerprices" />
    		<result column="CarCount" jdbcType="LONGVARCHAR" property="carcount" />
  	</association>
  </resultMap>
  
  <resultMap type="com.cnit.yoyo.model.car.Car" id="carTypeConfigMap" extends="BaseResultMap"> 
  	  
  	  <id column="BrandID" jdbcType="INTEGER" property="carConfigWithBLOBs.brandid" />
      <result column="car_id" jdbcType="INTEGER" property="carConfigWithBLOBs.carId" />
      <result column="CarGearbox" jdbcType="VARCHAR" property="carConfigWithBLOBs.cargearbox" />
      <result column="Configs" jdbcType="LONGVARCHAR" property="carConfigWithBLOBs.configs" />
      <result column="Options" jdbcType="LONGVARCHAR" property="carConfigWithBLOBs.options" />
      <result column="DealerPrices" jdbcType="LONGVARCHAR" property="carConfigWithBLOBs.dealerprices" />
      <result column="CarCount" jdbcType="LONGVARCHAR" property="carConfigWithBLOBs.carcount" />
      
      <collection property="carConfigs" ofType="com.cnit.yoyo.model.car.CarConfigWithBLOBs">  
		    <id column="BrandID" jdbcType="INTEGER" property="brandid" />
    		<result column="car_id" jdbcType="INTEGER" property="carId" />
    		<result column="CarGearbox" jdbcType="VARCHAR" property="cargearbox" />
    		<result column="Configs" jdbcType="LONGVARCHAR" property="configs" />
    		<result column="Options" jdbcType="LONGVARCHAR" property="options" />
    		<result column="DealerPrices" jdbcType="LONGVARCHAR" property="dealerprices" />
    		<result column="CarCount" jdbcType="LONGVARCHAR" property="carcount" />
      </collection>  
  </resultMap>
  
  <resultMap type="com.cnit.yoyo.model.car.dto.CarTypeDTO" extends="BaseResultMap" id="DTOResultMap">
    <result column="BrandName" jdbcType="VARCHAR" property="brandname" />
    <result column="factory_name" jdbcType="VARCHAR" property="factoryName" />
    <result column="car_dept_name" jdbcType="VARCHAR" property="carDeptName" />
    <result column="BrandLogo" jdbcType="VARCHAR" property="brandlogo" />
    <result column="car_year_value" jdbcType="VARCHAR" property="carYearValue" />
    <result column="grade_name" jdbcType="VARCHAR" property="gradename" />
    <result column="CarGearbox" jdbcType="VARCHAR" property="cargearbox" />
    <result column="brand_id" jdbcType="INTEGER" property="brandId" />
  </resultMap>
  
   <resultMap type="com.cnit.yoyo.model.car.dto.CarTypeDTO" extends="DTOResultMap" id="carInfoMap">
   	<result column="factoryId" jdbcType="INTEGER" property="factoryId" />
   	<result column="deptId" jdbcType="INTEGER" property="deptId" />
   	<result column="carYearId" jdbcType="INTEGER" property="carYearId" />
  </resultMap>
  
  
  <resultMap type="com.cnit.yoyo.model.car.dto.CarTypeConfigDTO" extends="BaseResultMap" id="DTODetailMap">
    <result column="Configs" jdbcType="VARCHAR" property="configs" />
  </resultMap>
  
  <resultMap type="com.cnit.yoyo.model.car.dto.CarTypeDeptDTO" extends="BaseResultMap" id="DTODeptMap">
    <result column="car_year_value" jdbcType="VARCHAR" property="carYearValue" />
  </resultMap>
  
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 19:29:06 CST 2015.
    -->
    car_id, car_dept_id, car_name, keyword, icon_file, view_count, last_update, status, 
    price, store_price, filter_id, isdel, isconfig
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 19:29:06 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_car
    where car_id = #{carId,jdbcType=INTEGER}
  </select>
  
    <select id="selectCarByName" resultMap="BaseResultMap" parameterType="java.lang.String">
        select 
        <include refid="Base_Column_List" />
        from t_car 
        where isdel='0' and car_name = #{carName,jdbcType=VARCHAR}
  </select>
  
    <!-- 通过车系id查找车型 -->
   <select id="findbyDeptId" resultType="java.lang.Integer" parameterType="java.lang.Integer" >
    select 
        car_dept_id
    from t_car
    where isdel='0' and car_dept_id in
    <foreach item="idItem" collection="array" open="(" separator="," close=")">
		#{idItem}
	</foreach>
  </select>
  
      <!-- 通过年款id查找车型 -->
   <select id="findbyYearId" resultType="java.lang.Integer" parameterType="java.lang.Integer" >
    select 
        filter_id
    from t_car
    where isdel='0' and filter_id in
    <foreach item="idItem" collection="array" open="(" separator="," close=")">
		#{idItem}
	</foreach>
  </select>
  
     <!-- 查找是否有同名的 -->
  <select id="findCarTypeByName" resultType="java.lang.Integer" parameterType="com.cnit.yoyo.model.car.dto.CarTypeDTO">
        select count(car_id) from t_car 
        where car_name = #{carName,jdbcType=VARCHAR}
  </select>
  
       <!-- 查找是否有同名的 -->
  <select id="findCarByName" resultType="java.lang.Integer" parameterType="com.cnit.yoyo.model.car.Car">
        select count(car_id) from t_car 
        where t_car.isdel='0' and car_name = #{carName,jdbcType=VARCHAR}
  </select>
  
   <select id="findCarTypeList" parameterType="map" resultMap="DTOResultMap">
   SELECT
	t_car.car_id AS carId,
	t_car.car_name AS carName,
	t_car.status,
	t_brand.brand_name as brandname,
	t_brand.brand_id as brandId,
	t_car_factory.factory_name AS factoryName,
	t_car_factory.factory_id AS factoryId,
	t_car_dept.car_dept_name AS carDeptName,
	t_car_dept.car_dept_id AS carDeptId,
	t_car.icon_file as iconFile,
	t_car_year.car_year_value AS carYearValue,
	t_car_year.id AS carYearId,
	t_car_brand_grade.grade_name AS gradeName,
	t_car_brand_grade.GradeID AS gradeId,
	t_car.price,
	t_car.isconfig
	FROM
	t_car
	INNER JOIN t_car_dept ON t_car_dept.car_dept_id = t_car.car_dept_id
	INNER JOIN t_car_factory ON t_car_factory.factory_id = t_car_dept.FactoryID
	INNER JOIN t_car_year ON t_car.filter_id = t_car_year.id
	INNER JOIN t_car_brand_grade ON t_car_dept.grade_id = t_car_brand_grade.GradeID
	INNER JOIN t_brand ON t_car_factory.brand_id = t_brand.brand_id
	where t_car.isdel='0' and t_brand.disabled='0' and t_car_dept.status=0 and
	 t_car_factory.disabled='0' and t_car_year.status=0 and t_car_brand_grade.status=0
        <if test="brandId != null and brandId !='' and brandId !=-1">  
            and t_brand.brand_id = #{brandId,jdbcType=INTEGER}
        </if>  
        <if test="factoryId != null and factoryId !='' and factoryId !=-1">  
            and t_car_factory.factory_id =  #{factoryId,jdbcType=INTEGER}
        </if>
        <if test="carDeptId != null and carDeptId !='' and carDeptId !=-1">  
            and t_car.car_dept_id =  #{carDeptId,jdbcType=INTEGER}
        </if> 
        <if test="carYearId != null and carYearId !='' and carYearId !=-1">  
            and t_car.filter_id =  #{carYearId,jdbcType=INTEGER}
        </if> 
        <if test="gradeId != null and gradeId !='' and gradeId !=-1">  
            and t_car_brand_grade.GradeID =  #{gradeId,jdbcType=INTEGER}
        </if> 
        <if test="carName != null and carName !=''">  
            and t_car.car_name =  #{carName,jdbcType=VARCHAR}
        </if>
        <if test="keyword != null and keyword !=''">  
            and t_car.keyword =  #{keyword,jdbcType=VARCHAR}
        </if>
     <!-- 排序规则 -->
		<if test="orderStmt != null">
			ORDER BY ${orderStmt}
		</if>
   <!-- SELECT
	t_car.car_id AS carId,
	t_car.car_name AS carName,
	t_brand.brand_name as brandname,
	t_car_factory.factory_name AS factoryName,
	t_car_dept.car_dept_name AS carDeptName,
	t_brand.brand_logo as brandlogo,
	t_car_year.car_year_value AS carYearValue,
	t_car_brand_grade.GradeName AS gradename,
	t_car_config.CarGearbox AS cargearbox
	FROM
	t_car
	INNER JOIN t_car_dept ON t_car_dept.car_dept_id = t_car.car_dept_id
	INNER JOIN t_car_factory ON t_car_factory.factory_id = t_car_dept.FactoryID
	INNER JOIN t_car_year ON t_car.filter_id = t_car_year.id
	INNER JOIN t_car_brand_grade ON t_car_dept.GradeID = t_car_brand_grade.GradeID
	INNER JOIN t_car_config ON t_car_config.car_id = t_car.car_id
	INNER JOIN t_brand ON t_car_factory.brand_id = t_brand.brand_id
	order by t_car.car_name DESC -->
  </select>
  
    <!-- 根据条件进行查找 -->
   <select id="findCarTypeDetail" parameterType="java.lang.Integer"
	resultMap="DTODetailMap">
	SELECT
	t_car.car_name,
	t_car.keyword,
	t_car.icon_file,
	t_car.view_count,
	t_car.`status`,
	t_car.price,
	t_car_config.Configs
	FROM
	t_car
	INNER JOIN
	t_car_config ON t_car_config.car_id = t_car.car_id
	where t_car.isdel='0'
	and t_car.car_id = #{carId,jdbcType=INTEGER}
  </select>
  
   <!-- 根据条件进行查找 -->
   <select id="findCarDetail" parameterType="java.lang.Integer" resultMap="DTODetailMap">
   SELECT
	t_car.car_id,
	t_car.car_dept_id,
	t_car.car_name,
	t_car.keyword,
	t_car.icon_file,
	t_car.view_count,
	t_car.last_update,
	t_car.`status`,
	t_car.price,
	t_car.store_price,
	t_car.filter_id,
	t_car.isdel,
	t_car_config.Configs
	FROM
	t_car
	INNER JOIN t_car_config ON t_car_config.car_id = t_car.car_id
	where t_car.isdel='0' and t_car.car_id = #{carId,jdbcType=INTEGER}
  </select>
  
  
  <!-- 根据条件进行查找 -->
   <select id="findCarDetailByIds" parameterType="java.lang.Integer" resultMap="carTypeConfigMap">
   SELECT
	t_car.car_id,
	t_car.car_dept_id,
	t_car.car_name,
	t_car.keyword,
	t_car.icon_file,
	t_car.view_count,
	t_car.last_update,
	t_car.`status`,
	t_car.price,
	t_car.store_price,
	t_car.filter_id,
	t_car.isdel,
	t_car_config.BrandID,
	t_car_config.car_id,
	t_car_config.Configs,
	t_car_config.`Options`,
	t_car_config.DealerPrices,
	t_car_config.CarCount,
	t_car_config.CarGearbox
	FROM
	t_car
	INNER JOIN t_car_config ON t_car_config.car_id = t_car.car_id
	where 
		t_car.isdel='0' and t_car.car_id in 
	<foreach collection="array" item="carId" index="index" open="(" close=")" separator=",">
		#{carId,jdbcType=INTEGER}
	</foreach>
  </select>
  
  <resultMap type="com.cnit.yoyo.model.car.dto.CarDeptDTO" id="CarDeptResultMap">
  		<id column="car_dept_id" property="carDeptId" jdbcType="INTEGER" />
	    <result column="FactoryID" property="factoryid" jdbcType="INTEGER" />
	    <result column="car_dept_name" property="carDeptName" jdbcType="VARCHAR" />
	    <result column="KeyWord" property="keyword" jdbcType="VARCHAR" />
	    <result column="grade_id" property="gradeId" jdbcType="INTEGER" />
	    <result column="status" jdbcType="INTEGER" property="status" />
	    <result column="brand_id" jdbcType="INTEGER" property="brandId" />
	    <result column="brand_name" jdbcType="VARCHAR" property="brandName" />
	    
  		<collection property="cars" ofType="com.cnit.yoyo.model.car.Car">
		    <id column="car_id" jdbcType="INTEGER" property="carId" />
		    <result column="car_dept_id" jdbcType="INTEGER" property="carDeptId" />
		    <result column="car_name" jdbcType="VARCHAR" property="carName" />
		    <result column="keyword" jdbcType="VARCHAR" property="keyword" />
		    <result column="icon_file" jdbcType="VARCHAR" property="iconFile" />
		    <result column="view_count" jdbcType="INTEGER" property="viewCount" />
		    <result column="last_update" jdbcType="TIMESTAMP" property="lastUpdate" />
		    <result column="status" jdbcType="VARCHAR" property="status" />
		    <result column="price" jdbcType="DECIMAL" property="price" />
		    <result column="store_price" jdbcType="DECIMAL" property="storePrice" />
		    <result column="filter_id" jdbcType="INTEGER" property="filterId" />
		    <result column="isdel" jdbcType="VARCHAR" property="isdel" />
		    <result column="isconfig" jdbcType="INTEGER" property="isconfig" />
		    <result column="Configs" jdbcType="INTEGER" property="carConfigWithBLOBs.configs" />		    
	  	</collection>
  </resultMap>
  
  <select id="findCarDetailByDeptId" parameterType="java.lang.Integer" resultMap="CarDeptResultMap">
	 SELECT
	    dept.car_dept_id, 
	    dept.FactoryID, 
	    dept.car_dept_name, 
	    dept.KeyWord, 
	    dept.grade_id, 
	    dept.status,
		brand.brand_id,
		brand.brand_name,
		t_car.car_id,
		t_car.car_dept_id,
		t_car.car_name,
		t_car.keyword,
		t_car.icon_file,
		t_car.view_count,
		t_car.last_update,
		t_car.`status`,
		t_car.price,
		t_car.store_price,
		t_car.filter_id,
		t_car.isdel,
		t_car_config.BrandID,
		t_car_config.car_id,
		t_car_config.Configs,
		t_car_config.`Options`,
		t_car_config.DealerPrices,
		t_car_config.CarCount,
		t_car_config.CarGearbox
		FROM
			t_car_dept dept
		INNER JOIN t_car_factory factory
			ON dept.FactoryID=factory.factory_id
		INNER JOIN t_brand brand
			ON factory.brand_id=brand.brand_id
		LEFT JOIN
			t_car ON dept.car_dept_id = t_car.car_dept_id
		INNER JOIN 
			t_car_config ON t_car_config.car_id = t_car.car_id
		WHERE 
		t_car.isdel='0' AND dept.car_dept_id =#{deptId};
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 19:29:06 CST 2015.
    -->
    delete from t_car
    where car_id = #{carId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.cnit.yoyo.model.car.Car">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 19:29:06 CST 2015.
    -->
    insert into t_car (car_id, car_dept_id, car_name, 
      keyword, icon_file, view_count, 
      last_update, status, price, 
      store_price, filter_id, isdel, isconfig
      )
    values (#{carId,jdbcType=INTEGER}, #{carDeptId,jdbcType=INTEGER}, #{carName,jdbcType=VARCHAR}, 
      #{keyword,jdbcType=VARCHAR}, #{iconFile,jdbcType=VARCHAR}, #{viewCount,jdbcType=INTEGER}, 
      #{lastUpdate,jdbcType=TIMESTAMP}, #{status,jdbcType=VARCHAR}, #{price,jdbcType=DECIMAL}, 
      #{storePrice,jdbcType=DECIMAL}, #{filterId,jdbcType=INTEGER}, #{isdel,jdbcType=VARCHAR},
      #{isconfig,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.cnit.yoyo.model.car.Car"  useGeneratedKeys="true" keyProperty="carId">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 19:29:06 CST 2015.
    -->
    insert into t_car
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="carId != null">
        car_id,
      </if>
      <if test="carDeptId != null">
        car_dept_id,
      </if>
      <if test="carName != null">
        car_name,
      </if>
      <if test="keyword != null">
        keyword,
      </if>
      <if test="iconFile != null">
        icon_file,
      </if>
      <if test="viewCount != null">
        view_count,
      </if>
      <if test="lastUpdate != null">
        last_update,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="price != null">
        price,
      </if>
      <if test="storePrice != null">
        store_price,
      </if>
      <if test="filterId != null">
        filter_id,
      </if>
      <if test="isdel != null">
        isdel,
      </if>
      <if test="isconfig != null">
        isconfig,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="carId != null">
        #{carId,jdbcType=INTEGER},
      </if>
      <if test="carDeptId != null">
        #{carDeptId,jdbcType=INTEGER},
      </if>
      <if test="carName != null">
        #{carName,jdbcType=VARCHAR},
      </if>
      <if test="keyword != null">
        #{keyword,jdbcType=VARCHAR},
      </if>
      <if test="iconFile != null">
        #{iconFile,jdbcType=VARCHAR},
      </if>
      <if test="viewCount != null">
        #{viewCount,jdbcType=INTEGER},
      </if>
      <if test="lastUpdate != null">
        #{lastUpdate,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="price != null">
        #{price,jdbcType=DECIMAL},
      </if>
      <if test="storePrice != null">
        #{storePrice,jdbcType=DECIMAL},
      </if>
      <if test="filterId != null">
        #{filterId,jdbcType=INTEGER},
      </if>
      <if test="isdel != null">
        #{isdel,jdbcType=VARCHAR},
      </if>
      <if test="isconfig != null">
        #{isconfig,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  
  <insert id="insertCarType" parameterType="com.cnit.yoyo.model.car.dto.CarTypeDTO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 19:29:06 CST 2015.
    -->
    insert into t_car
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="carDeptId != null">
        car_dept_id,
      </if>
      <if test="carName != null">
        car_name,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="carDeptId != null">
        #{carDeptId,jdbcType=INTEGER},
      </if>
      <if test="carName != null">
        #{carName,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  
  <update id="updateByPrimaryKeySelective" parameterType="com.cnit.yoyo.model.car.Car">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 19:29:06 CST 2015.
    -->
    update t_car
    <set>
      <if test="carDeptId != null">
        car_dept_id = #{carDeptId,jdbcType=INTEGER},
      </if>
      <if test="carName != null">
        car_name = #{carName,jdbcType=VARCHAR},
      </if>
      <if test="keyword != null">
        keyword = #{keyword,jdbcType=VARCHAR},
      </if>
      <if test="iconFile != null">
        icon_file = #{iconFile,jdbcType=VARCHAR},
      </if>
      <if test="viewCount != null">
        view_count = #{viewCount,jdbcType=INTEGER},
      </if>
      <if test="lastUpdate != null">
        last_update = #{lastUpdate,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="price != null">
        price = #{price,jdbcType=DECIMAL},
      </if>
      <if test="storePrice != null">
        store_price = #{storePrice,jdbcType=DECIMAL},
      </if>
      <if test="filterId != null">
        filter_id = #{filterId,jdbcType=INTEGER},
      </if>
      <if test="isdel != null">
        isdel = #{isdel,jdbcType=VARCHAR},
      </if>
      <if test="isconfig != null">
        isconfig = #{isconfig,jdbcType=INTEGER},
      </if>
    </set>
    where car_id = #{carId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.cnit.yoyo.model.car.Car">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 19:29:06 CST 2015.
    -->
    update t_car
    set car_dept_id = #{carDeptId,jdbcType=INTEGER},
      car_name = #{carName,jdbcType=VARCHAR},
      keyword = #{keyword,jdbcType=VARCHAR},
      icon_file = #{iconFile,jdbcType=VARCHAR},
      view_count = #{viewCount,jdbcType=INTEGER},
      last_update = #{lastUpdate,jdbcType=TIMESTAMP},
      status = #{status,jdbcType=VARCHAR},
      price = #{price,jdbcType=DECIMAL},
      store_price = #{storePrice,jdbcType=DECIMAL},
      filter_id = #{filterId,jdbcType=INTEGER},
      isdel = #{isdel,jdbcType=VARCHAR},
      isconfig = #{isconfig,jdbcType=INTEGER}
    where car_id = #{carId,jdbcType=INTEGER}
  </update>
  
   <select id="findList" resultMap="BaseResultMap" parameterType="java.lang.Integer">
    select 
    <include refid="Base_Column_List" />
    from t_car where isdel = '0'
     <if test="_parameter !=null and _parameter !=0">
      and   filter_id =  #{_parameter}
    </if>
  </select>
  
  <select id="findCarByDeptId" resultMap="DTODeptMap" parameterType="java.lang.Integer">
    select c.car_id,c.car_name,c.filter_id,y.car_year_value 
    from t_car c, t_car_year y 
    where y.id=c.filter_id and c.car_dept_id = #{carDeptId,jdbcType=INTEGER}
  </select>
  
  
  
  <!-- 根据carId查找厂商，车系等 -->
  <select id="findCarInfo" parameterType="java.lang.Integer" resultMap="carInfoMap">
   SELECT DISTINCT
	t_car.car_id AS carId,
	t_car.car_name AS carName,
	t_car_factory.factory_name AS factoryName,
	t_car_dept.car_dept_name AS carDeptName,
	t_brand.brand_name as brandname,
	t_brand.brand_logo as brandlogo,
	t_brand.brand_id,
	t_car_year.car_year_value AS carYearValue,
	t_car_brand_grade.grade_name AS gradename,
	t_car.car_dept_id AS deptId,
	t_car.filter_id AS carYearId,
	t_car_factory.factory_id AS factoryId
	FROM
	t_car
	INNER JOIN t_car_dept ON t_car_dept.car_dept_id = t_car.car_dept_id
	INNER JOIN t_car_factory ON t_car_factory.factory_id = t_car_dept.FactoryID
	INNER JOIN t_car_year ON t_car.filter_id = t_car_year.id
	INNER JOIN t_car_brand_grade ON t_car_dept.grade_id = t_car_brand_grade.GradeID
	INNER JOIN t_brand ON t_car_factory.brand_id = t_brand.brand_id
	where t_car.isdel='0' and t_car.car_id in
	<foreach item="item" index="index" collection="array" open="(" separator="," close=")">
         #{item}
    </foreach>
  </select>
  
  
  <select id="selectCarByDept" parameterType="java.lang.Integer" resultMap="BaseResultMap">
	  select
	  	<include refid="Base_Column_List" />
	  from  
	  	t_car
	  where t_car.isdel='0' and car_dept_id=#{deptId,jdbcType=INTEGER}
  </select>
  
  <select id="selectByCarDeptId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from t_car
    where t_car.isdel='0' and car_dept_id = #{carDeptId,jdbcType=INTEGER}
  </select>
  
    <select id="selectCar" parameterType="java.util.Map" resultMap="BaseResultMap">
	  SELECT
	  	<include refid="Base_Column_List" />
	  FROM 
	  	t_car
	  WHERE
	  	t_car.isdel='0'
	  <if test="deptId != null">
	  	AND car_dept_id=#{deptId,jdbcType=INTEGER}
	  </if>
	  <if test="carYearId != null">
	  	AND filter_id=#{carYearId}
	  </if>
  </select>
  
  <update id="updateIsdelByIds">
    update t_car
    set isdel = #{isdel,jdbcType=VARCHAR}
    where car_id in 
      <foreach item="item" index="index" collection="ids" open="(" separator="," close=")">
         #{item}
      </foreach>
  </update>
  
  <select id="selectByBrandId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    SELECT c.*
	FROM t_car c
	INNER JOIN t_car_dept cd ON cd.car_dept_id = c.car_dept_id
	INNER JOIN t_car_factory cf ON cf.factory_id = cd.FactoryID
	INNER JOIN t_brand b ON cf.brand_id = b.brand_id
	where c.isdel='0' and b.disabled='0' and cd.status=0 and
	 cf.disabled='0' and b.brand_id = #{brandId,jdbcType=INTEGER}
    order by c.last_update DESC
  </select>
  
  <select id="selectCarByYearHasGoods" resultMap="BaseResultMap">
  	SELECT
		car.car_id,
		car.car_dept_id,
		car.car_name,
		car.keyword,
		car.icon_file,
		car.view_count,
		car.last_update,
		car.STATUS,
		car.price,
		car.store_price,
		car.filter_id,
		car.isdel,
		car.isconfig
	FROM
		t_car car
	INNER JOIN
		t_goods goods ON goods.CAR_ID = car.car_id
	WHERE
		car.isdel = 0
	AND car.filter_id=#{carYearId}
	AND car.car_dept_id=#{carDeptId}
	AND goods.DISABLED = 0
	AND goods.MARKETABLE = 1
	GROUP BY car.car_id
  </select>
  <select id="selectCarSpiderData" parameterType="com.cnit.yoyo.autohome.model.AutohomeCarInfoDTO" resultMap="carConfigResultMap">
		SELECT
			car.car_id,
			car.car_dept_id,
			car.car_name,
			car.keyword,
			car.icon_file,
			car.view_count,
			car.last_update,
			car.`status`,
			car.price,
			car.store_price,
			car.filter_id,
			car.isdel,
			config.BrandID,
			config.car_id,
			config.Configs,
			config.`Options`,
			config.DealerPrices,
			config.CarCount,
			config.CarGearbox
		from t_car car INNER JOIN t_car_autohome ta on ta.car_id = car.car_id
		INNER JOIN t_car_config config ON config.car_id = car.car_id
		<if test="relationId !=null and relationId !=0 ">
			where ta.car_id = #{relationId,jdbcType=INTEGER}
        </if>
  </select>
</mapper>