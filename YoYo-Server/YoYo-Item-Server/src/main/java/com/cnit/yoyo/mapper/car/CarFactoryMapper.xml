<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cnit.yoyo.dao.car.CarFactoryMapper">
  <resultMap id="BaseResultMap" type="com.cnit.yoyo.model.car.CarFactory">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Mar 28 11:32:32 CST 2015.
    -->
    <id column="factory_id" jdbcType="INTEGER" property="factoryId" />
    <result column="factory_name" jdbcType="VARCHAR" property="factoryName" />
    <result column="link_url" jdbcType="VARCHAR" property="linkUrl" />
    <result column="group_id" jdbcType="INTEGER" property="groupId" />
    <result column="scope_id" jdbcType="INTEGER" property="scopeId" />
    <result column="brand_id" jdbcType="INTEGER" property="brandId" />
    <result column="icon_file" jdbcType="VARCHAR" property="iconFile" />
    <result column="pinyin" jdbcType="VARCHAR" property="pinyin" />
    <result column="createtime" jdbcType="TIMESTAMP" property="createtime" />
    <result column="car_brand_brandtobrand" jdbcType="VARCHAR" property="carBrandBrandtobrand" />
    <result column="disabled" jdbcType="VARCHAR" property="disabled" />
  </resultMap>
  
  <resultMap type="com.cnit.yoyo.model.car.dto.CarFactoryDTO" extends="BaseResultMap" id="DTOResultMap">
    <result column="car_type" jdbcType="VARCHAR" property="carType" />
    <result column="brand_name" jdbcType="VARCHAR" property="brandName" />
  </resultMap>
  
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Mar 28 11:32:32 CST 2015.
    -->
    factory_id, factory_name, link_url, group_id,scope_id, brand_id, icon_file, pinyin, 
    createtime, car_brand_brandtobrand, disabled
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Mar 28 11:32:32 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_car_factory
    where factory_id = #{factoryId,jdbcType=INTEGER}
  </select>
  
  <select id="findSelect" resultMap="BaseResultMap" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Mar 28 11:32:32 CST 2015.
    -->
    select 
    factory_id, factory_name
    from t_car_factory
    where disabled='0'
    <if test="_parameter !=null and _parameter !=0">
       and brand_id =  #{_parameter}
    </if>
  </select>
 
  <insert id="insert" parameterType="com.cnit.yoyo.model.car.CarFactory">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Mar 28 11:32:32 CST 2015.
    -->
    insert into t_car_factory (factory_id, factory_name, link_url, 
      group_id, scope_id, brand_id, 
      icon_file, pinyin, createtime, 
      car_brand_brandtobrand, disabled)
    values (#{factoryId,jdbcType=INTEGER}, #{factoryName,jdbcType=VARCHAR}, #{linkUrl,jdbcType=VARCHAR}, 
      #{groupId,jdbcType=INTEGER}, #{scopeId,jdbcType=INTEGER}, #{brandId,jdbcType=INTEGER}, 
      #{iconFile,jdbcType=VARCHAR}, #{pinyin,jdbcType=VARCHAR}, #{createtime,jdbcType=TIMESTAMP}, 
      #{carBrandBrandtobrand,jdbcType=VARCHAR}, #{disabled,jdbcType=VARCHAR})
  </insert>
  
  <update id="updateByPrimaryKeySelective" parameterType="com.cnit.yoyo.model.car.CarFactory">
  
    update t_car_factory
    <set>
      <if test="factoryName != null">
        factory_name = #{factoryName,jdbcType=VARCHAR},
      </if>
      <if test="linkUrl != null">
        link_url = #{linkUrl,jdbcType=VARCHAR},
      </if>
      <if test="groupId != null">
        group_id = #{groupId,jdbcType=INTEGER},
      </if>
      <if test="scopeId != null">
        scope_id = #{scopeId,jdbcType=INTEGER},
      </if>
      <if test="brandId != null">
        brand_id = #{brandId,jdbcType=INTEGER},
      </if>
      <if test="iconFile != null">
        icon_file = #{iconFile,jdbcType=VARCHAR},
      </if>
      <if test="pinyin != null">
        pinyin = #{pinyin,jdbcType=VARCHAR},
      </if>
      <if test="createtime != null">
        createtime = #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="carBrandBrandtobrand != null">
        car_brand_brandtobrand = #{carBrandBrandtobrand,jdbcType=VARCHAR},
      </if>
      <if test="disabled != null and disabled!=''">
        disabled = #{disabled,jdbcType=VARCHAR},
      </if>
    </set>
    where factory_id = #{factoryId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.cnit.yoyo.model.car.CarFactory">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Mar 28 11:32:32 CST 2015.
    -->
    update t_car_factory
    set factory_name = #{factoryName,jdbcType=VARCHAR},
      link_url = #{linkUrl,jdbcType=VARCHAR},
      group_id = #{groupId,jdbcType=INTEGER},
      scope_id = #{scopeId,jdbcType=INTEGER},
      brand_id = #{brandId,jdbcType=INTEGER},
      icon_file = #{iconFile,jdbcType=VARCHAR},
      pinyin = #{pinyin,jdbcType=VARCHAR},
      createtime = #{createtime,jdbcType=TIMESTAMP},
      car_brand_brandtobrand = #{carBrandBrandtobrand,jdbcType=VARCHAR},
      disabled = #{disabled,jdbcType=VARCHAR}
    where factory_id = #{factoryId,jdbcType=INTEGER}
  </update>
  
  <!-- 插入 -->
  <insert id="insertSelective" parameterType="com.cnit.yoyo.model.car.CarFactory"  useGeneratedKeys="true" keyProperty="factoryId">
   
    insert into t_car_factory
    <trim prefix="(" suffix=")" suffixOverrides=",">
      
      <if test="factoryName != null">
        factory_name,
      </if>
      <if test="linkUrl != null">
        link_url,
      </if>
      <if test="groupId != null">
        group_id,
      </if>
      <if test="scopeId != null">
        scope_id,
      </if>
      <if test="brandId != null">
        brand_id,
      </if>
      <if test="iconFile != null">
        icon_file,
      </if>
      <if test="pinyin != null">
        pinyin,
      </if>
      <if test="createtime != null">
        createtime,
      </if>
      <if test="carBrandBrandtobrand != null">
        car_brand_brandtobrand,
      </if>
      <if test="disabled != null and disabled!=''">
        disabled,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      
      <if test="factoryName != null">
        #{factoryName,jdbcType=VARCHAR},
      </if>
      <if test="linkUrl != null">
        #{linkUrl,jdbcType=VARCHAR},
      </if>
      <if test="groupId != null">
        #{groupId,jdbcType=INTEGER},
      </if>
      <if test="scopeId != null">
        #{scopeId,jdbcType=INTEGER},
      </if>
      <if test="brandId != null">
        #{brandId,jdbcType=INTEGER},
      </if>
      <if test="iconFile != null">
        #{iconFile,jdbcType=VARCHAR},
      </if>
      <if test="pinyin != null">
        #{pinyin,jdbcType=VARCHAR},
      </if>
      <if test="createtime != null">
        #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="carBrandBrandtobrand != null">
        #{carBrandBrandtobrand,jdbcType=VARCHAR},
      </if>
      <if test="disabled != null  and disabled!=''">
        #{disabled,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  
   <!-- 根据条件进行查找 -->
   <select id="findList" parameterType="com.cnit.yoyo.model.car.CarFactory" resultMap="DTOResultMap">
    select 
    t_car_factory.factory_id, factory_name, link_url, group_id, t_car_factory.scope_id, t_car_factory.brand_id, icon_file, pinyin, 
    t_car_factory.createtime, car_brand_brandtobrand, t_car_factory.disabled,car_type,brand_name
    from t_car_factory  join t_car_factory_scope tcfs on   t_car_factory.scope_id = tcfs.scope_id join t_brand on t_car_factory.brand_id=t_brand.brand_id 
    where t_car_factory.disabled='0' 
    <if test="factoryName != null and factoryName!='' ">
        and factory_name LIKE CONCAT('%', #{factoryName,jdbcType=VARCHAR},'%')  
    </if>
    
    <if test="brandId != null and brandId!=0 and brandId!=-1">
        and  t_car_factory.brand_id = #{brandId,jdbcType=INTEGER}
    </if>
    
    <if test="scopeId != null and scopeId!=0 and scopeId!=-1"> <!-- 高级查询时，-1表示没有选择 -->
        and  t_car_factory.scope_id = #{scopeId,jdbcType=INTEGER}
    </if>
    
     <if test="pinyin != null and pinyin!='' ">
       and  pinyin LIKE CONCAT('%', #{pinyin,jdbcType=VARCHAR},'%')  
    </if>
    
     <if test="linkUrl != null and linkUrl!='' ">
       and  link_url LIKE CONCAT('%', #{linkUrl,jdbcType=VARCHAR},'%')
    </if>
    
     <if test="carBrandBrandtobrand != null and carBrandBrandtobrand!='' and carBrandBrandtobrand!='-1'">
       and  car_brand_brandtobrand = #{carBrandBrandtobrand,jdbcType=VARCHAR}
    </if>
     <if test="orderStmt != null and orderStmt!=''">
		ORDER BY ${orderStmt}
	</if>
  </select>
  
  <!-- 通过厂商区域id查找厂商 -->
  <select id="selectByScopeId" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    select 
        count(factory_id)
    from t_car_factory
    where disabled='0' and scope_id = #{id,jdbcType=INTEGER}
  </select>
  
    <!-- 通过厂商区域id查找厂商 -->
  <select id="selectByScopeIds" parameterType="java.lang.Integer" resultType="java.lang.String">
    SELECT 
    	t1.car_type 
    FROM 
    	t_car_factory t 
    JOIN t_car_factory_scope t1 ON t.scope_id=t1.scope_id
    where t.disabled='0' and t.scope_id in
    <foreach collection="array" item="id" index="index" open="(" close=")" separator=",">
         #{id}
    </foreach>
    group by t.scope_id
  </select>
  
  <select id="selectCarFactoryByBrand" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select 
        <include refid="Base_Column_List" />
    FROM 
    	t_car_factory 
    where 
    	brand_id = #{brandId,jdbcType=INTEGER} and disabled='0'
  </select>
  
  
   <!-- 查找是否有同名的 -->
  <select id="findByName" resultType="java.lang.Integer" parameterType="com.cnit.yoyo.model.car.CarFactory">
        select count(factory_id) from t_car_factory 
        where disabled='0' and factory_name = #{factoryName,jdbcType=VARCHAR}
        <if test="factoryId !=null and factoryId !=0 ">
             and factory_id != #{factoryId,jdbcType=INTEGER}
        </if>
  </select>
  
  <sql id="Car_Dept_Column_List" >
    dept.car_dept_id, dept.FactoryID, dept.car_dept_name, dept.KeyWord, dept.grade_id, dept.status
  </sql>
  
  <resultMap type="com.cnit.yoyo.model.car.dto.CarFactoryDTO" id="CarFactoryIncludeCarDeptResulMap" extends="BaseResultMap">
  	<collection property="carDepts" ofType="com.cnit.yoyo.model.car.CarDept" column="FactoryID">
  		<id column="car_dept_id" property="carDeptId" jdbcType="INTEGER" />
	    <result column="FactoryID" property="factoryid" jdbcType="INTEGER" />
	    <result column="car_dept_name" property="carDeptName" jdbcType="VARCHAR" />
	    <result column="KeyWord" property="keyword" jdbcType="VARCHAR" />
	    <result column="grade_id" property="gradeId" jdbcType="VARCHAR" />
	    <result column="status" jdbcType="INTEGER" property="status" />
  	</collection>
  </resultMap>
  
  <select id="selectCarFactoryIncludeCarDept" resultMap="CarFactoryIncludeCarDeptResulMap">
		SELECT
			<include refid="Base_Column_List"/>,
			<include refid="Car_Dept_Column_List"/>
		FROM
			t_car_factory factory
		LEFT JOIN t_car_dept dept ON factory.factory_id = dept.FactoryID
		WHERE
			factory.disabled = 0
		AND 
			dept.status = 0
		AND 
			factory.brand_id= #{brandId,jdbcType=INTEGER}		
  </select>
  
  <select id="selectCarFactoryIncludeCarDeptHasGoods" resultMap="CarFactoryIncludeCarDeptResulMap">
		SELECT
			factory.factory_id,
			factory.factory_name,
			factory.link_url,
			factory.group_id,
			factory.scope_id,
			factory.brand_id,
			factory.icon_file,
			factory.pinyin, 
			factory.createtime,
			factory.car_brand_brandtobrand,
			factory.disabled,
			dept.car_dept_id,
			dept.FactoryID,
			dept.car_dept_name, 
			dept.KeyWord, 
			dept.grade_id, 
			dept.status
		FROM
			t_car_factory factory
		INNER JOIN t_car_dept dept ON factory.factory_id = dept.FactoryID
		INNER JOIN t_car car ON car.car_dept_id=dept.car_dept_id
		INNER JOIN t_goods goods ON goods.CAR_ID=car.car_id
		WHERE 
			factory.brand_id= #{brandId,jdbcType=INTEGER}
		AND factory.disabled = 0		
		AND dept.status = 0
		AND car.isdel=0
		AND goods.DISABLED=0
		AND goods.MARKETABLE=1
  </select>
  
  <select id="selectCarFactorySpiderDataList" resultMap="CarFactoryIncludeCarDeptResulMap">
		SELECT
			factory.factory_id,
			factory.factory_name,
			factory.link_url,
			factory.group_id,
			factory.scope_id,
			factory.brand_id,
			factory.icon_file,
			factory.pinyin, 
			factory.createtime,
			factory.car_brand_brandtobrand,
			factory.disabled,
			dept.car_dept_id,
			dept.FactoryID,
			dept.car_dept_name, 
			dept.KeyWord, 
			dept.grade_id, 
			dept.status
		from t_car_factory_autohome ta INNER JOIN t_car_factory tf on ta.factory_id = tf.factory_id
		where ta.factory_id in
	    <foreach collection="list" item="item" index="index" open="(" close=")" separator=",">
			#{item.relationId}
		</foreach>
  </select>
  <select id="selectCarFactorySpiderData" parameterType="com.cnit.yoyo.autohome.model.AutohomeCarInfoDTO" resultMap="CarFactoryIncludeCarDeptResulMap">
		SELECT
			tf.factory_id,
			tf.factory_name,
			tf.link_url,
			tf.group_id,
			tf.scope_id,
			tf.brand_id,
			tf.icon_file,
			tf.pinyin, 
			tf.createtime,
			tf.car_brand_brandtobrand,
			tf.disabled
		from t_car_factory_autohome ta INNER JOIN t_car_factory tf on ta.factory_id = tf.factory_id
		<if test="relationId !=null and relationId !=0 ">
			where ta.factory_id = #{relationId,jdbcType=INTEGER}
        </if>
  </select>
  
  <!-- 逻辑删除 -->
   <update id="deleteByPrimaryKey" >
    update  t_car_factory set disabled = '1'
    where factory_id in
     <foreach collection="array" item="factoryId" index="index"
            open="(" close=")" separator=",">
            #{factoryId}
        </foreach>
  </update>
</mapper>