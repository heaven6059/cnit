<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cnit.yoyo.dao.goods.DriveOrConsultMapper">
  <resultMap id="BaseResultMap" type="com.cnit.yoyo.model.goods.DriveOrConsult">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="car_id" jdbcType="INTEGER" property="carId" />
    <result column="province_id" jdbcType="INTEGER" property="provinceId" />
    <result column="city_id" jdbcType="INTEGER" property="cityId" />
    <result column="county_id" jdbcType="INTEGER" property="countyId" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="user_sex" jdbcType="CHAR" property="userSex" />
    <result column="phone" jdbcType="VARCHAR" property="phone" />
    <result column="type" jdbcType="VARCHAR" property="type" />
    <result column="dealer_id" jdbcType="VARCHAR" property="dealerId" />
    <result column="is_replace" jdbcType="INTEGER" property="isReplace" />
    <result column="add_time" jdbcType="BIGINT" property="addTime" />
    <result column="state" jdbcType="INTEGER" property="state" />
  </resultMap>
  
  <resultMap id="DTOResultMap" type="com.cnit.yoyo.model.goods.dto.DriveOrConsultDTO">
		<id column="id" jdbcType="INTEGER" property="id" />
	    <result column="car_id" jdbcType="INTEGER" property="carId" />
	    <result column="province_id" jdbcType="INTEGER" property="provinceId" />
	    <result column="city_id" jdbcType="INTEGER" property="cityId" />
	    <result column="county_id" jdbcType="INTEGER" property="countyId" />
	    <result column="user_name" jdbcType="VARCHAR" property="userName" />
	    <result column="user_sex" jdbcType="CHAR" property="userSex" />
	    <result column="phone" jdbcType="VARCHAR" property="phone" />
	    <result column="type" jdbcType="VARCHAR" property="type" />
	    <result column="dealer_id" jdbcType="VARCHAR" property="dealerId" />
	    <result column="is_replace" jdbcType="INTEGER" property="isReplace" />
	    <result column="add_time" jdbcType="BIGINT" property="addTime" />
	    <result column="state" jdbcType="INTEGER" property="state" />
	    <result column="area_name" jdbcType="VARCHAR" property="cityName" />
	</resultMap>
  
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    id, car_id, province_id, city_id, county_id, user_name, user_sex, phone, type, dealer_id, 
    is_replace, add_time, state
  </sql>
  <select id="selectByExample" parameterType="com.cnit.yoyo.model.goods.DriveOrConsultExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    'false' as QUERYID,
    <include refid="Base_Column_List" />
    from t_drive_or_consult
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_drive_or_consult
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    delete from t_drive_or_consult
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <delete id="deleteByExample" parameterType="com.cnit.yoyo.model.goods.DriveOrConsultExample">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    delete from t_drive_or_consult
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.cnit.yoyo.model.goods.DriveOrConsult">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    insert into t_drive_or_consult (id, car_id, province_id, 
      city_id, county_id, user_name, 
      user_sex, phone, type, 
      dealer_id, is_replace, add_time, 
      state)
    values (#{id,jdbcType=INTEGER}, #{carId,jdbcType=INTEGER}, #{provinceId,jdbcType=INTEGER}, 
      #{cityId,jdbcType=INTEGER}, #{countyId,jdbcType=INTEGER}, #{userName,jdbcType=VARCHAR}, 
      #{userSex,jdbcType=CHAR}, #{phone,jdbcType=VARCHAR}, #{type,jdbcType=VARCHAR}, 
      #{dealerId,jdbcType=VARCHAR}, #{isReplace,jdbcType=INTEGER}, #{addTime,jdbcType=BIGINT}, 
      #{state,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.cnit.yoyo.model.goods.DriveOrConsult">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    insert into t_drive_or_consult
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="carId != null">
        car_id,
      </if>
      <if test="provinceId != null">
        province_id,
      </if>
      <if test="cityId != null">
        city_id,
      </if>
      <if test="countyId != null">
        county_id,
      </if>
      <if test="userName != null">
        user_name,
      </if>
      <if test="userSex != null">
        user_sex,
      </if>
      <if test="phone != null">
        phone,
      </if>
      <if test="type != null">
        type,
      </if>
      <if test="dealerId != null">
        dealer_id,
      </if>
      <if test="isReplace != null">
        is_replace,
      </if>
      <if test="addTime != null">
        add_time,
      </if>
      <if test="state != null">
        state,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="carId != null">
        #{carId,jdbcType=INTEGER},
      </if>
      <if test="provinceId != null">
        #{provinceId,jdbcType=INTEGER},
      </if>
      <if test="cityId != null">
        #{cityId,jdbcType=INTEGER},
      </if>
      <if test="countyId != null">
        #{countyId,jdbcType=INTEGER},
      </if>
      <if test="userName != null">
        #{userName,jdbcType=VARCHAR},
      </if>
      <if test="userSex != null">
        #{userSex,jdbcType=CHAR},
      </if>
      <if test="phone != null">
        #{phone,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        #{type,jdbcType=VARCHAR},
      </if>
      <if test="dealerId != null">
        #{dealerId,jdbcType=VARCHAR},
      </if>
      <if test="isReplace != null">
        #{isReplace,jdbcType=INTEGER},
      </if>
      <if test="addTime != null">
        #{addTime,jdbcType=BIGINT},
      </if>
      <if test="state != null">
        #{state,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.cnit.yoyo.model.goods.DriveOrConsultExample" resultType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    select count(*) from t_drive_or_consult
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    update t_drive_or_consult
    <set>
      <if test="record.id != null">
        id = #{record.id,jdbcType=INTEGER},
      </if>
      <if test="record.carId != null">
        car_id = #{record.carId,jdbcType=INTEGER},
      </if>
      <if test="record.provinceId != null">
        province_id = #{record.provinceId,jdbcType=INTEGER},
      </if>
      <if test="record.cityId != null">
        city_id = #{record.cityId,jdbcType=INTEGER},
      </if>
      <if test="record.countyId != null">
        county_id = #{record.countyId,jdbcType=INTEGER},
      </if>
      <if test="record.userName != null">
        user_name = #{record.userName,jdbcType=VARCHAR},
      </if>
      <if test="record.userSex != null">
        user_sex = #{record.userSex,jdbcType=CHAR},
      </if>
      <if test="record.phone != null">
        phone = #{record.phone,jdbcType=VARCHAR},
      </if>
      <if test="record.type != null">
        type = #{record.type,jdbcType=VARCHAR},
      </if>
      <if test="record.dealerId != null">
        dealer_id = #{record.dealerId,jdbcType=VARCHAR},
      </if>
      <if test="record.isReplace != null">
        is_replace = #{record.isReplace,jdbcType=INTEGER},
      </if>
      <if test="record.addTime != null">
        add_time = #{record.addTime,jdbcType=BIGINT},
      </if>
      <if test="record.state != null">
        state = #{record.state,jdbcType=INTEGER},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    update t_drive_or_consult
    set id = #{record.id,jdbcType=INTEGER},
      car_id = #{record.carId,jdbcType=INTEGER},
      province_id = #{record.provinceId,jdbcType=INTEGER},
      city_id = #{record.cityId,jdbcType=INTEGER},
      county_id = #{record.countyId,jdbcType=INTEGER},
      user_name = #{record.userName,jdbcType=VARCHAR},
      user_sex = #{record.userSex,jdbcType=CHAR},
      phone = #{record.phone,jdbcType=VARCHAR},
      type = #{record.type,jdbcType=VARCHAR},
      dealer_id = #{record.dealerId,jdbcType=VARCHAR},
      is_replace = #{record.isReplace,jdbcType=INTEGER},
      add_time = #{record.addTime,jdbcType=BIGINT},
      state = #{record.state,jdbcType=INTEGER}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.cnit.yoyo.model.goods.DriveOrConsult">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    update t_drive_or_consult
    <set>
      <if test="carId != null">
        car_id = #{carId,jdbcType=INTEGER},
      </if>
      <if test="provinceId != null">
        province_id = #{provinceId,jdbcType=INTEGER},
      </if>
      <if test="cityId != null">
        city_id = #{cityId,jdbcType=INTEGER},
      </if>
      <if test="countyId != null">
        county_id = #{countyId,jdbcType=INTEGER},
      </if>
      <if test="userName != null">
        user_name = #{userName,jdbcType=VARCHAR},
      </if>
      <if test="userSex != null">
        user_sex = #{userSex,jdbcType=CHAR},
      </if>
      <if test="phone != null">
        phone = #{phone,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        type = #{type,jdbcType=VARCHAR},
      </if>
      <if test="dealerId != null">
        dealer_id = #{dealerId,jdbcType=VARCHAR},
      </if>
      <if test="isReplace != null">
        is_replace = #{isReplace,jdbcType=INTEGER},
      </if>
      <if test="addTime != null">
        add_time = #{addTime,jdbcType=BIGINT},
      </if>
      <if test="state != null">
        state = #{state,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.cnit.yoyo.model.goods.DriveOrConsult">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 12 16:37:40 CST 2015.
    -->
    update t_drive_or_consult
    set car_id = #{carId,jdbcType=INTEGER},
      province_id = #{provinceId,jdbcType=INTEGER},
      city_id = #{cityId,jdbcType=INTEGER},
      county_id = #{countyId,jdbcType=INTEGER},
      user_name = #{userName,jdbcType=VARCHAR},
      user_sex = #{userSex,jdbcType=CHAR},
      phone = #{phone,jdbcType=VARCHAR},
      type = #{type,jdbcType=VARCHAR},
      dealer_id = #{dealerId,jdbcType=VARCHAR},
      is_replace = #{isReplace,jdbcType=INTEGER},
      add_time = #{addTime,jdbcType=BIGINT},
      state = #{state,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <!-- <select id="selectByParam" parameterType="com.cnit.yoyo.model.goods.DriveOrConsult" resultMap="BaseResultMap">
    select  *
    from t_drive_or_consult
    where 1=1  
    <if test="carId!=null">
      and car_id= #{carId}
    </if>
    <if test="provinceId!=null">
      and province_id= #{provinceId}
    </if>
    <if test="cityId!=null">
      and city_id= #{cityId}
    </if>
    <if test="countyId!=null">
      and county_id= #{countyId}
    </if>
    <if test="userName!=null">
      and user_name= #{userName}
    </if>
    <if test="userSex!=null">
      and user_sex= #{userSex}
    </if>
    <if test="phone!=null">
      and phone= #{phone}
    </if>
    <if test="type!=null">
      and type= #{type}
    </if>
    <if test="dealerId!=null">
      and dealer_id= #{dealerId}
    </if>
  </select> -->
  
  <select id="selectByParam"  resultMap="BaseResultMap">
    select  *
    from t_drive_or_consult
    where car_id = #{carId} and city_id = #{cityId} and phone = #{phone} and type = #{type}
    and is_replace = #{isReplace} and state = #{state}
  </select>
  
  <!-- <select id="selectAll"  resultMap="DTOResultMap">
    select  c.*, a.area_name
    from t_drive_or_consult c, area a
    where c.city_id =  a.area_id 
    order by c.add_time desc
  </select> -->
  
  <select id="selectAllByType"  resultMap="DTOResultMap">
    <!-- select  c.*, a.area_name
    from t_drive_or_consult c, area a
    where c.city_id =  a.area_id 
    <if test="_parameter != null">
    	and c.type = #{type} 
    </if>
    order by c.add_time desc -->
    SELECT
		doc.*, city.area_name
	FROM
		t_drive_or_consult doc
	INNER JOIN t_car car ON doc.car_id=car.car_id
	INNER JOIN area county ON doc.county_id=county.area_id
	INNER JOIN area city ON doc.city_id=city.area_id
	INNER JOIN area province ON doc.province_id=province.area_id
	LEFT JOIN t_consult_replace consultReplace ON consultReplace.consult_id=doc.id
	LEFT JOIN t_car replaceCar ON replaceCar.car_id=consultReplace.car_id
	LEFT JOIN t_car_dept replaceDept ON replaceDept.car_dept_id=consultReplace.car_dept_id
	LEFT JOIN t_brand replaceBrand ON replaceBrand.brand_id=consultReplace.brand_id
	WHERE
		1=1
	<if test="_parameter != null">
    	and doc.type = #{type} 
    </if>
	order by doc.add_time desc
  </select>
  
  <resultMap type="com.cnit.yoyo.model.other.drive.ReservationDrive" id="ReservationDriveResultMap">
  		<id column="id" property="id"/>
  		<result column="user_name" property="userName"/>
  		<result column="user_sex" property="userSex"/>
		<result column="phone" property="phone"/>
		<result column="add_time" property="addTime"/>
		<result column="county" property="county"/>
		<result column="city" property="city"/>
		<result column="province" property="province"/>
		<result column="car_name" property="carName"/>
		<result column="is_replace" property="isReplace"/>
		<result column="car_miles" property="carMiles"/>
		<result column="card_year" property="cardYear"/>
		<result column="card_month" property="cardMonth"/>
		<result column="replaceBrand" property="replaceBrand"/>
		<result column="replaceDept" property="replaceDept"/>
		<result column="replaceCar" property="replaceCar"/>
		
  </resultMap>
  
  <select id="selectReservationDrive" resultMap="ReservationDriveResultMap" parameterType="com.cnit.yoyo.model.other.drive.dto.ReservationDriveQryDTO">
	SELECT
		doc.id,
		doc.user_name,
		doc.user_sex,
		doc.phone,
		doc.add_time,
		car.car_name,
		county.area_name county,
		city.area_name city,
		province.area_name province
	FROM
		t_drive_or_consult doc
	INNER JOIN
		t_car car ON doc.car_id=car.car_id
	INNER JOIN
		area county ON doc.county_id=county.area_id
	INNER JOIN
		area city ON doc.city_id=city.area_id
	INNER JOIN
		area province ON doc.province_id=province.area_id
	where
		doc.type=2
	<if test="carId !=null and carId >0">	
		and doc.car_id=#{carId}
	</if>
	<if test="userName != null">
		and doc.user_name  LIKE CONCAT('%', #{userName,jdbcType=VARCHAR},'%') 
	</if>
	<if test="userSex !=null">
		and doc.user_sex =#{userSex}
	</if>
	<if test="phone !=null and phone != ''">
		and doc.phone  LIKE CONCAT('%', #{phone,jdbcType=VARCHAR},'%')
	</if>
  </select>
  
  
  <select id="selectShopReservationDrive" resultMap="ReservationDriveResultMap" parameterType="com.cnit.yoyo.model.other.drive.dto.ReservationDriveQryDTO">
	SELECT
		doc.id,
		doc.user_name,
		doc.user_sex,
		doc.phone,
		doc.add_time,
		car.car_name,
		county.area_name county,
		city.area_name city,
		province.area_name province
	FROM
		t_drive_or_consult doc
	INNER JOIN
		t_car car ON doc.car_id=car.car_id
	INNER JOIN
		area county ON doc.county_id=county.area_id
	INNER JOIN
		area city ON doc.city_id=city.area_id
	INNER JOIN
		area province ON doc.province_id=province.area_id
	where
		doc.type=2
	AND
		doc.car_id IN(SELECT CAR_ID from t_goods goods WHERE goods.CAR_ID>0 AND goods.DISABLED=0 AND goods.MARKETABLE=1 AND goods.STORE_ID=#{storeId})
	<if test="carId !=null and carId >0">	
		and doc.car_id=#{carId}
	</if>
	<if test="userName != null">
		and doc.user_name  LIKE CONCAT('%', #{userName,jdbcType=VARCHAR},'%') 
	</if>
	<if test="userSex !=null">
		and doc.user_sex =#{userSex}
	</if>
	<if test="phone !=null and phone != ''">
		and doc.phone  LIKE CONCAT('%', #{phone,jdbcType=VARCHAR},'%')
	</if>
  </select>
  
  <select id="selectLowPriceConsult" resultMap="ReservationDriveResultMap" parameterType="com.cnit.yoyo.model.other.drive.dto.ReservationDriveQryDTO">
  	SELECT
		doc.type,
		doc.id,
		doc.user_name,
		doc.user_sex,
		doc.phone,
		doc.add_time,
		doc.is_replace,
		car.car_name,
		county.area_name county,
		city.area_name city,
		province.area_name province,
		consultReplace.car_miles,
		consultReplace.card_year,
		consultReplace.card_month,
		replaceBrand.brand_name replaceBrand,
		replaceDept.car_dept_name replaceDept,
		replaceCar.car_name replaceCar
	FROM
		t_drive_or_consult doc
	INNER JOIN t_car car ON doc.car_id=car.car_id
	INNER JOIN area county ON doc.county_id=county.area_id
	INNER JOIN area city ON doc.city_id=city.area_id
	INNER JOIN area province ON doc.province_id=province.area_id
	LEFT JOIN t_consult_replace consultReplace ON consultReplace.consult_id=doc.id
	LEFT JOIN t_car replaceCar ON replaceCar.car_id=consultReplace.car_id
	LEFT JOIN t_car_dept replaceDept ON replaceDept.car_dept_id=consultReplace.car_dept_id
	LEFT JOIN t_brand replaceBrand ON replaceBrand.brand_id=consultReplace.brand_id
	WHERE
		type=1
	<if test="carId !=null and carId >0">	
		and doc.car_id=#{carId}
	</if>
	<if test="userName != null">
		and doc.user_name  LIKE CONCAT('%', #{userName,jdbcType=VARCHAR},'%') 
	</if>
	<if test="userSex !=null">
		and doc.user_sex =#{userSex}
	</if>
	<if test="phone !=null and phone != ''">
		and doc.phone  LIKE CONCAT('%', #{phone,jdbcType=VARCHAR},'%')
	</if>
	<if test="isReplace != null">
		and doc.is_replace =#{isReplace}
	</if>
	<if test="replaceBrandId !=null and replaceBrandId>0">
		and consultReplace.brand_id=#{replaceBrandId}
	</if>
	<if test="replaceDepId !=null and replaceDepId>0">
		and consultReplace.car_dept_id=#{replaceDepId}
	</if>
	<if test="replaceCarId !=null and replaceCarId>0">
		and consultReplace.brand_id=#{replaceCarId}
	</if>
  </select>
  
  
  <select id="selectShopLowPriceConsult" resultMap="ReservationDriveResultMap" parameterType="com.cnit.yoyo.model.other.drive.dto.ReservationDriveQryDTO">
  	SELECT
		doc.type,
		doc.id,
		doc.user_name,
		doc.user_sex,
		doc.phone,
		doc.add_time,
		doc.is_replace,
		car.car_name,
		county.area_name county,
		city.area_name city,
		province.area_name province,
		consultReplace.car_miles,
		consultReplace.card_year,
		consultReplace.card_month,
		replaceBrand.brand_name replaceBrand,
		replaceDept.car_dept_name replaceDept,
		replaceCar.car_name replaceCar
	FROM
		t_drive_or_consult doc
	INNER JOIN t_car car ON doc.car_id=car.car_id
	INNER JOIN area county ON doc.county_id=county.area_id
	INNER JOIN area city ON doc.city_id=city.area_id
	INNER JOIN area province ON doc.province_id=province.area_id
	LEFT JOIN t_consult_replace consultReplace ON consultReplace.consult_id=doc.id
	LEFT JOIN t_car replaceCar ON replaceCar.car_id=consultReplace.car_id
	LEFT JOIN t_car_dept replaceDept ON replaceDept.car_dept_id=consultReplace.car_dept_id
	LEFT JOIN t_brand replaceBrand ON replaceBrand.brand_id=consultReplace.brand_id
	WHERE
		type=1
	AND
		doc.car_id IN(SELECT CAR_ID from t_goods goods WHERE goods.CAR_ID>0 AND goods.DISABLED=0 AND goods.MARKETABLE=1 AND goods.STORE_ID=#{storeId})
	<if test="carId !=null and carId >0">	
		and doc.car_id=#{carId}
	</if>
	<if test="userName != null">
		and doc.user_name  LIKE CONCAT('%', #{userName,jdbcType=VARCHAR},'%') 
	</if>
	<if test="userSex !=null">
		and doc.user_sex =#{userSex}
	</if>
	<if test="phone !=null and phone != ''">
		and doc.phone  LIKE CONCAT('%', #{phone,jdbcType=VARCHAR},'%')
	</if>
	<if test="isReplace != null">
		and doc.is_replace =#{isReplace}
	</if>
	<if test="replaceBrandId !=null and replaceBrandId>0">
		and consultReplace.brand_id=#{replaceBrandId}
	</if>
	<if test="replaceDepId !=null and replaceDepId>0">
		and consultReplace.car_dept_id=#{replaceDepId}
	</if>
	<if test="replaceCarId !=null and replaceCarId>0">
		and consultReplace.brand_id=#{replaceCarId}
	</if>
  </select>
  
  <delete id="deleteDriveOrConsult">
  		delete from t_drive_or_consult where id in
    	<foreach collection="array" item="id" index="index" open="(" close=")" separator=",">
            #{id}
        </foreach>
  </delete>
</mapper>