<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cnit.yoyo.dao.car.CarDeptMapper" >
  <resultMap id="BaseResultMap" type="com.cnit.yoyo.model.car.CarDept" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 15:57:07 CST 2015.
    -->
    <id column="car_dept_id" property="carDeptId" jdbcType="INTEGER" />
    <result column="FactoryID" property="factoryid" jdbcType="INTEGER" />
    <result column="car_dept_name" property="carDeptName" jdbcType="VARCHAR" />
    <result column="KeyWord" property="keyword" jdbcType="VARCHAR" />
    <result column="grade_id" property="gradeId" jdbcType="INTEGER" />
    <result column="status" jdbcType="INTEGER" property="status" />
  </resultMap>
  
  <resultMap type="com.cnit.yoyo.model.car.dto.CarDeptDTO" extends="BaseResultMap" id="DTOResultMap">
    <result column="FactoryName" jdbcType="VARCHAR" property="factoryName" />
    <result column="grade_name" jdbcType="VARCHAR" property="gradeName" />
  </resultMap>
  
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 15:57:07 CST 2015.
    -->
    car_dept_id, FactoryID, car_dept_name, KeyWord, grade_id, status
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 15:57:07 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_car_dept
    where car_dept_id = #{carDeptId,jdbcType=INTEGER}
  </select>
  
  <select id="selectByQueryParams" resultMap="DTOResultMap" parameterType="map">
		SELECT
		t_car_dept.car_dept_id,
		t_car_dept.car_dept_name,
		t_car_dept.KeyWord,
		t_car_brand_grade.grade_name,
		t_car_brand_grade.gradeid,
		t_car_factory.factory_name as factoryName,
		t_car_factory.factory_id as factoryid
		FROM
		t_car_dept
		JOIN t_car_factory ON t_car_dept.FactoryID = t_car_factory.factory_id
		JOIN t_car_brand_grade ON t_car_brand_grade.GradeID = t_car_dept.grade_id
	    where t_car_dept.status = 0
		<foreach index="index" item="item" collection="whereStmt">
			and ${item}
		</foreach>
		<!-- 排序规则 -->
		<if test="orderStmt != null">
			ORDER BY ${orderStmt}
		</if>
	</select>
  
     <!-- 根据条件进行查找 -->
   <select id="findList" parameterType="map" resultMap="DTOResultMap">
    SELECT
	t_car_dept.car_dept_id,
	t_car_dept.car_dept_name,
	t_car_dept.KeyWord,
	t_car_brand_grade.grade_name,
	t_car_brand_grade.gradeid,
	t_car_factory.factory_name as factoryName,
	t_car_factory.factory_id as factoryid
	FROM
	t_car_dept
	JOIN t_car_factory ON t_car_dept.FactoryID = t_car_factory.factory_id
	JOIN t_car_brand_grade ON t_car_brand_grade.GradeID = t_car_dept.grade_id
    where t_car_dept.status = 0
	    <if test="carDeptName != null and carDeptName!='' ">
	        and t_car_dept.car_dept_name LIKE CONCAT('%', #{carDeptName,jdbcType=VARCHAR},'%')  
	    </if>
	    
	    <if test="keyword != null and keyword!='' ">
	        and  t_car_dept.KeyWord = #{keyword,jdbcType=VARCHAR}
	    </if>
	    
	    <if test="factoryid != null and factoryid!=0 and factoryid!=-1"> <!-- 高级查询时，-1表示没有选择 -->
	        and  t_car_dept.FactoryID = #{factoryid,jdbcType=INTEGER}
	    </if>
	    
	    <if test="gradeId != null and gradeId !=0 and gradeId !=-1"> <!-- 高级查询时，-1表示没有选择 -->
	        and  t_car_dept.grade_id = #{gradeId,jdbcType=INTEGER}
	    </if>
    <!-- 排序规则 -->
		<if test="orderStmt != null">
			ORDER BY ${orderStmt}
		</if>
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 15:57:07 CST 2015.
    -->
    delete from t_car_dept
    where car_dept_id = #{carDeptId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.cnit.yoyo.model.car.CarDept" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 15:57:07 CST 2015.
    -->
    insert into t_car_dept (car_dept_id, FactoryID, car_dept_name, 
      KeyWord, grade_id)
    values (#{carDeptId,jdbcType=INTEGER}, #{factoryid,jdbcType=INTEGER}, #{carDeptName,jdbcType=VARCHAR}, 
      #{keyword,jdbcType=VARCHAR}, #{gradeId,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.cnit.yoyo.model.car.CarDept" useGeneratedKeys="true" keyProperty="carDeptId">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 15:57:07 CST 2015.
    -->
    insert into t_car_dept
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="carDeptId != null" >
        car_dept_id,
      </if>
      <if test="factoryid != null" >
        FactoryID,
      </if>
      <if test="carDeptName != null" >
        car_dept_name,
      </if>
      <if test="keyword != null" >
        KeyWord,
      </if>
      <if test="gradeId != null" >
        grade_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="carDeptId != null" >
        #{carDeptId,jdbcType=INTEGER},
      </if>
      <if test="factoryid != null" >
        #{factoryid,jdbcType=INTEGER},
      </if>
      <if test="carDeptName != null" >
        #{carDeptName,jdbcType=VARCHAR},
      </if>
      <if test="keyword != null" >
        #{keyword,jdbcType=VARCHAR},
      </if>
      <if test="gradeId != null" >
        #{gradeId,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.cnit.yoyo.model.car.CarDept" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 15:57:07 CST 2015.
    -->
    update t_car_dept
    <set >
      <if test="factoryid != null" >
        FactoryID = #{factoryid,jdbcType=INTEGER},
      </if>
      <if test="carDeptName != null" >
        car_dept_name = #{carDeptName,jdbcType=VARCHAR},
      </if>
      <if test="keyword != null" >
        KeyWord = #{keyword,jdbcType=VARCHAR},
      </if>
      <if test="gradeId != null" >
        grade_id = #{gradeId,jdbcType=VARCHAR},
      </if>
    </set>
    where car_dept_id = #{carDeptId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.cnit.yoyo.model.car.CarDept" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 26 15:57:07 CST 2015.
    -->
    update t_car_dept
    set FactoryID = #{factoryid,jdbcType=INTEGER},
      car_dept_name = #{carDeptName,jdbcType=VARCHAR},
      KeyWord = #{keyword,jdbcType=VARCHAR},
      grade_id = #{gradeId,jdbcType=VARCHAR}
    where car_dept_id = #{carDeptId,jdbcType=INTEGER}
  </update>
  
  <!-- 通过厂商id查找车系 -->
   <select id="selectByFactoryId" resultType="java.lang.Integer" parameterType="java.lang.Integer" >
    select 
        count(car_dept_id)
    from t_car_dept
    where status = 0 and FactoryID = #{factoryid,jdbcType=INTEGER}
     
  </select>
  
         <!-- 查找是否有同名的 -->
  <select id="findByName" resultType="java.lang.Integer" parameterType="com.cnit.yoyo.model.car.CarDept">
        select count(car_dept_id) from t_car_dept 
        where status = 0 and car_dept_name = #{carDeptName,jdbcType=VARCHAR}
        <if test="carDeptId !=null and carDeptId !=0 ">
             and car_dept_id != #{carDeptId,jdbcType=INTEGER}
        </if>
  </select>
  
  <!-- 通过级别id查找车系 -->
   <select id="findByGradeId" resultType="java.lang.Integer" parameterType="java.lang.Integer" >
    select 
        grade_id
    from t_car_dept
    where status = 0 and grade_id in
    <foreach item="idItem" collection="array" open="(" separator="," close=")">
		#{idItem}
	</foreach>
  </select>
  
    <select id="findSelect" resultMap="BaseResultMap" parameterType="com.cnit.yoyo.model.car.CarDept">
    select 
    car_dept_id, car_dept_name
    from t_car_dept
     where status = 0
	    <if test="factoryid != null and factoryid!=0 and factoryid!=-1"> 
	        and FactoryID = #{factoryid,jdbcType=INTEGER}
	    </if>
	    
	    <if test="gradeId != null and gradeId !='' and gradeId !=-1"> 
	        and  grade_id = #{gradeId,jdbcType=INTEGER}
	    </if>
  </select>
  
  <select id="selectCarDeptByFactory" resultMap="BaseResultMap" parameterType="java.lang.Integer">
    select 
    	<include refid="Base_Column_List" />
    from t_car_dept
    where status = 0  and FactoryID =  #{factoryId,jdbcType=INTEGER}
  </select>
  
  <select id="selectAllCarDept" resultMap="BaseResultMap" >
    select *
    from t_car_dept where status = 0
  </select>
  
  <select id="selectByBrandId" resultMap="BaseResultMap"  >
    select DISTINCT d.* from 
	t_car_config cf, t_car c, t_car_dept d
	where cf.car_id  = c.car_id and c.car_dept_id = d.car_dept_id and cf.brandId = #{brandId}
  </select>
  
  <update id="updateStatusByIds">
    update t_car_dept
    set status = #{status,jdbcType=INTEGER}
    where car_dept_id in 
      <foreach item="item" index="index" collection="ids" open="(" separator="," close=")">
         #{item}
      </foreach>
  </update>
  
  <select id="selectByCarId" resultMap="BaseResultMap"  >
    select DISTINCT d.* from 
	t_car c, t_car_dept d
	where c.car_dept_id = d.car_dept_id and c.car_id = #{carId}
  </select>
  
   <select id="selectCarDeptSpiderDataList" resultMap="BaseResultMap">
		SELECT td.car_dept_id, td.FactoryID, td.car_dept_name, td.KeyWord, td.grade_id, td.status
		from t_car_dept_autohome ta INNER JOIN t_car_dept td on ta.car_dept_id = td.car_dept_id
		where ta.car_dept_id in
	    <foreach collection="list" item="item" index="index" open="(" close=")" separator=",">
			#{item.relationId}
		</foreach>
  </select>
  <select id="selectCarDeptSpiderData" parameterType="com.cnit.yoyo.autohome.model.AutohomeCarInfoDTO" resultMap="BaseResultMap">
		SELECT td.car_dept_id, td.FactoryID, td.car_dept_name, td.KeyWord, td.grade_id, td.status
		from t_car_dept_autohome ta INNER JOIN t_car_dept td on ta.car_dept_id = td.car_dept_id
		<if test="relationId !=null and relationId !=0 ">
			where ta.car_dept_id = #{relationId,jdbcType=INTEGER}
        </if>
  </select>
</mapper>