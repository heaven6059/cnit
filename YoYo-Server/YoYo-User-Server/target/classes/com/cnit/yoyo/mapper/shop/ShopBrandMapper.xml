<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cnit.yoyo.dao.shop.ShopBrandMapper">
  <resultMap id="BaseResultMap" type="com.cnit.yoyo.model.shop.ShopBrand">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 24 10:13:14 CST 2015.
    -->
    <id column="company_brand_id" jdbcType="INTEGER" property="companyBrandId" />
    <id column="company_id" jdbcType="BIGINT" property="companyId" />
    <result column="brand_id" jdbcType="INTEGER" property="brandId" />
    <result column="brand_name" jdbcType="VARCHAR" property="brandName" />
    <result column="store_cat" jdbcType="INTEGER" property="storeCat" />
    <result column="brand_url" jdbcType="VARCHAR" property="brandUrl" />
    <result column="brand_logo" jdbcType="VARCHAR" property="brandLogo" />
    <result column="brand_aptitude" jdbcType="VARCHAR" property="brandAptitude" />
    <result column="disabled" jdbcType="VARCHAR" property="disabled" />
    <result column="status" jdbcType="VARCHAR" property="status" />
    <result column="type" jdbcType="VARCHAR" property="type" />
    <result column="label" jdbcType="VARCHAR" property="label" />
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.cnit.yoyo.model.shop.ShopBrandWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 24 10:13:14 CST 2015.
    -->
    <result column="brand_keywords" jdbcType="LONGVARCHAR" property="brandKeywords" />
    <result column="brand_desc" jdbcType="LONGVARCHAR" property="brandDesc" />
    <result column="fail_reason" jdbcType="LONGVARCHAR" property="failReason" />
  </resultMap>
  
  <resultMap extends="ResultMapWithBLOBs" id="ResultMapDTO" type="com.cnit.yoyo.model.goods.dto.ShopBrandBLOBsWithLabel">
    <result column="company_name" jdbcType="VARCHAR" property="companyName" />
    <result column="CAT_NAME" jdbcType="VARCHAR" property="catalogName" />
  </resultMap>
  
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 24 10:13:14 CST 2015.
    -->
    company_brand_id, company_id, brand_id, brand_name, store_cat, brand_url, brand_logo, 
    brand_aptitude, disabled, status, type,label
  </sql>
  <sql id="Blob_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 24 10:13:14 CST 2015.
    -->
    brand_keywords, brand_desc, fail_reason
  </sql>
  <select id="selectByPrimaryKey" parameterType="com.cnit.yoyo.model.shop.ShopBrandKey" resultMap="ResultMapWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 24 10:13:14 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from t_business_brand
    where company_brand_id = #{companyBrandId,jdbcType=INTEGER}
      and company_id = #{companyId,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="com.cnit.yoyo.model.shop.ShopBrandKey">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 24 10:13:14 CST 2015.
    -->
    delete from t_business_brand
    where company_brand_id = #{companyBrandId,jdbcType=INTEGER}
      and company_id = #{companyId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.cnit.yoyo.model.shop.ShopBrandWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 24 10:13:14 CST 2015.
    -->
    insert into t_business_brand (company_brand_id, company_id, brand_id, 
      brand_name, store_cat, brand_url, 
      brand_logo, brand_aptitude, disabled, 
      status, type, brand_keywords, 
      brand_desc, fail_reason,label)
    values (#{companyBrandId,jdbcType=INTEGER}, #{companyId,jdbcType=BIGINT}, #{brandId,jdbcType=INTEGER}, 
      #{brandName,jdbcType=VARCHAR}, #{storeCat,jdbcType=INTEGER}, #{brandUrl,jdbcType=VARCHAR}, 
      #{brandLogo,jdbcType=VARCHAR}, #{brandAptitude,jdbcType=VARCHAR}, #{disabled,jdbcType=VARCHAR}, 
      #{status,jdbcType=VARCHAR}, #{type,jdbcType=VARCHAR}, #{brandKeywords,jdbcType=LONGVARCHAR}, 
      #{brandDesc,jdbcType=LONGVARCHAR}, #{failReason,jdbcType=LONGVARCHAR}, #{label,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.cnit.yoyo.model.shop.ShopBrandWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 24 10:13:14 CST 2015.
    -->
    insert into t_business_brand
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="companyBrandId != null">
        company_brand_id,
      </if>
      <if test="companyId != null">
        company_id,
      </if>
      <if test="brandId != null">
        brand_id,
      </if>
      <if test="brandName != null">
        brand_name,
      </if>
      <if test="storeCat != null">
        store_cat,
      </if>
      <if test="brandUrl != null">
        brand_url,
      </if>
      <if test="brandLogo != null">
        brand_logo,
      </if>
      <if test="brandAptitude != null">
        brand_aptitude,
      </if>
      <if test="disabled != null">
        disabled,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="type != null">
        type,
      </if>
      <if test="label != null">
        label,
      </if>
      <if test="brandKeywords != null">
        brand_keywords,
      </if>
      <if test="brandDesc != null">
        brand_desc,
      </if>
      <if test="failReason != null">
        fail_reason,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="companyBrandId != null">
        #{companyBrandId,jdbcType=INTEGER},
      </if>
      <if test="companyId != null">
        #{companyId,jdbcType=BIGINT},
      </if>
      <if test="brandId != null">
        #{brandId,jdbcType=INTEGER},
      </if>
      <if test="brandName != null">
        #{brandName,jdbcType=VARCHAR},
      </if>
      <if test="storeCat != null">
        #{storeCat,jdbcType=INTEGER},
      </if>
      <if test="brandUrl != null">
        #{brandUrl,jdbcType=VARCHAR},
      </if>
      <if test="brandLogo != null">
        #{brandLogo,jdbcType=VARCHAR},
      </if>
      <if test="brandAptitude != null">
        #{brandAptitude,jdbcType=VARCHAR},
      </if>
      <if test="disabled != null">
        #{disabled,jdbcType=VARCHAR},
      </if>
      <if test="status != null">
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        #{type,jdbcType=VARCHAR},
      </if>
      <if test="label != null">
        #{label,jdbcType=VARCHAR},
      </if>
      <if test="brandKeywords != null">
        #{brandKeywords,jdbcType=LONGVARCHAR},
      </if>
      <if test="brandDesc != null">
        #{brandDesc,jdbcType=LONGVARCHAR},
      </if>
      <if test="failReason != null">
        #{failReason,jdbcType=LONGVARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.cnit.yoyo.model.shop.ShopBrandWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 24 10:13:14 CST 2015.
    -->
    update t_business_brand
    <set>
      <if test="brandId != null">
        brand_id = #{brandId,jdbcType=INTEGER},
      </if>
      <if test="brandName != null">
        brand_name = #{brandName,jdbcType=VARCHAR},
      </if>
      <if test="storeCat != null">
        store_cat = #{storeCat,jdbcType=INTEGER},
      </if>
      <if test="brandUrl != null">
        brand_url = #{brandUrl,jdbcType=VARCHAR},
      </if>
      <if test="brandLogo != null">
        brand_logo = #{brandLogo,jdbcType=VARCHAR},
      </if>
      <if test="brandAptitude != null">
        brand_aptitude = #{brandAptitude,jdbcType=VARCHAR},
      </if>
      <if test="disabled != null">
        disabled = #{disabled,jdbcType=VARCHAR},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        type = #{type,jdbcType=VARCHAR},
      </if>
      <if test="label != null">
        label = #{label,jdbcType=VARCHAR},
      </if>
      <if test="brandKeywords != null">
        brand_keywords = #{brandKeywords,jdbcType=LONGVARCHAR},
      </if>
      <if test="brandDesc != null">
        brand_desc = #{brandDesc,jdbcType=LONGVARCHAR},
      </if>
      <if test="failReason != null">
        fail_reason = #{failReason,jdbcType=LONGVARCHAR},
      </if>
    </set>
    where company_brand_id = #{companyBrandId,jdbcType=INTEGER}
      and company_id = #{companyId,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.cnit.yoyo.model.shop.ShopBrandWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 24 10:13:14 CST 2015.
    -->
    update t_business_brand
    set brand_id = #{brandId,jdbcType=INTEGER},
      brand_name = #{brandName,jdbcType=VARCHAR},
      store_cat = #{storeCat,jdbcType=INTEGER},
      brand_url = #{brandUrl,jdbcType=VARCHAR},
      brand_logo = #{brandLogo,jdbcType=VARCHAR},
      brand_aptitude = #{brandAptitude,jdbcType=VARCHAR},
      disabled = #{disabled,jdbcType=VARCHAR},
      status = #{status,jdbcType=VARCHAR},
      type = #{type,jdbcType=VARCHAR},
      label = #{label,jdbcType=VARCHAR},
      brand_keywords = #{brandKeywords,jdbcType=LONGVARCHAR},
      brand_desc = #{brandDesc,jdbcType=LONGVARCHAR},
      fail_reason = #{failReason,jdbcType=LONGVARCHAR}
    where company_brand_id = #{companyBrandId,jdbcType=INTEGER}
      and company_id = #{companyId,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.cnit.yoyo.model.shop.ShopBrand">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 24 10:13:14 CST 2015.
    -->
    update t_business_brand
    set brand_id = #{brandId,jdbcType=INTEGER},
      brand_name = #{brandName,jdbcType=VARCHAR},
      store_cat = #{storeCat,jdbcType=INTEGER},
      brand_url = #{brandUrl,jdbcType=VARCHAR},
      brand_logo = #{brandLogo,jdbcType=VARCHAR},
      brand_aptitude = #{brandAptitude,jdbcType=VARCHAR},
      disabled = #{disabled,jdbcType=VARCHAR},
      status = #{status,jdbcType=VARCHAR},
      type = #{type,jdbcType=VARCHAR},
      label = #{label,jdbcType=VARCHAR}
    where company_brand_id = #{companyBrandId,jdbcType=INTEGER}
      and company_id = #{companyId,jdbcType=BIGINT}
  </update>
  
  <select id="findBrandBusinessList" resultMap="ResultMapDTO" parameterType="com.cnit.yoyo.model.shop.ShopBrandWithBLOBs">
	select t_company.company_name,tgvc.CAT_NAME,    tbb.brand_keywords, tbb.brand_desc, tbb.fail_reason,
	  tbb.company_brand_id, tbb.company_id, tbb.brand_id, tbb.brand_name, tbb.store_cat, tbb.brand_url, tbb.brand_logo, 
      tbb.brand_aptitude, tbb.disabled, tbb.status, tbb.type,tbb.label
	  from t_business_brand  tbb JOIN t_company ON tbb.company_id=t_company.company_id
	  left JOIN t_goods_cat tgvc ON tgvc.CAT_ID=tbb.store_cat
  	  where tbb.disabled='0' 
  	  <if test="companyId!=null and companyId!=0">and tbb.company_id=#{companyId,jdbcType=BIGINT}</if>
	  order by tbb.company_brand_id desc
  </select>
  
  <select id="findBrandBusinessByStatus" resultMap="ResultMapDTO" parameterType="String">
	 select t_company.company_name,tgvc.CAT_NAME,    tbb.brand_keywords, tbb.brand_desc, tbb.fail_reason,
	  tbb.company_brand_id, tbb.company_id, tbb.brand_id, tbb.brand_name, tbb.store_cat, tbb.brand_url, tbb.brand_logo, 
      tbb.brand_aptitude, tbb.disabled, tbb.status, tbb.type,tbb.label
	  from t_business_brand  tbb JOIN t_company ON tbb.company_id=t_company.company_id
	  left JOIN t_goods_cat tgvc ON tgvc.CAT_ID=tbb.store_cat
  	  where tbb.disabled='0'  and tbb.status = #{status} 
	  order by company_brand_id desc
  </select>
  
  <update id="deleteByPrimaryKeys" >
    update t_business_brand set disabled='1' 
    where company_brand_id in
        <foreach collection="array" item="id" index="index"
            open="(" close=")" separator=",">
            #{id}
        </foreach>
  </update>
  
  <update id="updateLabelBrandById" parameterType="map">
    update t_business_brand set label = 
    <if test="#{labelIds} != null">
    	#{labelIds} 
    </if>
    <if test="#{labelIds} == null">
    	null 
    </if>
    where company_brand_id = #{brandIds} 
  </update>
  
  
  <!-- 批量插入 -->
  <insert id="insertBatchSelective">
    insert into t_business_brand ( company_id, brand_id, 
      brand_name,  brand_url, 
      brand_logo, brand_aptitude, 
      type, brand_keywords, 
      brand_desc)
  	<foreach collection="list" index="index" item="item"
			separator="union all">
			SELECT #{item.companyId,jdbcType=INTEGER}, #{item.brandId,jdbcType=INTEGER},#{item.brandName,jdbcType=VARCHAR}
			,#{item.brandUrl,jdbcType=VARCHAR},#{item.brandLogo,jdbcType=VARCHAR},#{item.brandAptitude,jdbcType=VARCHAR},'1',
			#{item.brandKeywords,jdbcType=VARCHAR},#{item.brandDesc,jdbcType=VARCHAR} FROM DUAL
		</foreach>
  </insert>
  
  <!-- 查找店铺的品牌 -->
  <select id="findBrandStatus" resultMap="ResultMapWithBLOBs" >
  	 select   tbb.brand_keywords, tbb.brand_desc, tbb.fail_reason,
	  tbb.company_brand_id, tbb.company_id, tbb.brand_id, tbb.brand_name, tbb.store_cat, tbb.brand_url, tbb.brand_logo, 
      tbb.brand_aptitude, tbb.disabled, tbb.status, tbb.type,tbb.label
	  from t_business_brand  tbb 
  	  where tbb.disabled='0'  and tbb.status = #{status}  and company_id=#{companyId}
	  order by company_brand_id desc
  
  </select>
  
  <update id="cancelBrandBusiness" parameterType="java.lang.Integer">
  	update t_business_brand set status='3' where company_brand_id = #{companyBrandId,jdbcType=INTEGER}
  </update>
  <!-- 判断是否重复申请新品牌 -->
  <select id="judgeCheck" parameterType="com.cnit.yoyo.model.shop.ShopBrandWithBLOBs" resultType="java.lang.Integer">
  	 select count(*) from t_business_brand where status!='2' and disabled='0' and 
  	 brand_name =#{brandName,jdbcType=VARCHAR} and store_cat=#{storeCat,jdbcType=INTEGER}
  	 <if test="companyBrandId!=null and companyBrandId!=0">
  	 	and company_brand_id!=#{companyBrandId,jdbcType=INTEGER}
  	 </if>
  </select>
  
    <!-- 判断是否重复申请已有品牌 -->
  <select id="judgeOldCheck"  resultType="java.lang.Integer">
   select count(*) from t_business_brand where status!='2' and disabled='0' and 
  	 brand_id in 
  	 <foreach collection="array" index="index" item="item" open="(" close=")" separator=",">
  	 		#{item}
  	 </foreach>
  	
  </select>
</mapper>